"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SSMParameterReader = void 0;
const aws_cdk_lib_1 = require("aws-cdk-lib");
const CustomResource = require("aws-cdk-lib/custom-resources");
function removeLeadingSlash(value) {
    return value.slice(0, 1) == "/" ? value.slice(1) : value;
}
class SSMParameterReader extends CustomResource.AwsCustomResource {
    constructor(scope, name, props) {
        const { parameterName, region } = props;
        const ssmAwsSdkCall = {
            service: "SSM",
            action: "getParameter",
            parameters: {
                Name: parameterName,
            },
            region,
            physicalResourceId: CustomResource.PhysicalResourceId.of(Date.now().toString()),
        };
        const ssmCrPolicy = CustomResource.AwsCustomResourcePolicy.fromSdkCalls({
            resources: [
                aws_cdk_lib_1.Arn.format({
                    service: "ssm",
                    region: props.region,
                    resource: "parameter",
                    resourceName: removeLeadingSlash(parameterName),
                }, aws_cdk_lib_1.Stack.of(scope)),
            ],
        });
        super(scope, name, { onUpdate: ssmAwsSdkCall, policy: ssmCrPolicy });
    }
    getParameterValue() {
        return this.getResponseField("Parameter.Value").toString();
    }
}
exports.SSMParameterReader = SSMParameterReader;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3NtLXBhcmFtZXRlci1yZWFkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzc20tcGFyYW1ldGVyLXJlYWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw2Q0FBeUM7QUFDekMsK0RBQStEO0FBUS9ELFNBQVMsa0JBQWtCLENBQUMsS0FBYTtJQUN2QyxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQzNELENBQUM7QUFDRCxNQUFhLGtCQUFtQixTQUFRLGNBQWMsQ0FBQyxpQkFBaUI7SUFDdEUsWUFBWSxLQUFnQixFQUFFLElBQVksRUFBRSxLQUE4QjtRQUN4RSxNQUFNLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxHQUFHLEtBQUssQ0FBQztRQUV4QyxNQUFNLGFBQWEsR0FBOEI7WUFDL0MsT0FBTyxFQUFFLEtBQUs7WUFDZCxNQUFNLEVBQUUsY0FBYztZQUN0QixVQUFVLEVBQUU7Z0JBQ1YsSUFBSSxFQUFFLGFBQWE7YUFDcEI7WUFDRCxNQUFNO1lBQ04sa0JBQWtCLEVBQUUsY0FBYyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FDdEQsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUN0QjtTQUNGLENBQUM7UUFFRixNQUFNLFdBQVcsR0FBRyxjQUFjLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDO1lBQ3RFLFNBQVMsRUFBRTtnQkFDVCxpQkFBRyxDQUFDLE1BQU0sQ0FDUjtvQkFDRSxPQUFPLEVBQUUsS0FBSztvQkFDZCxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07b0JBQ3BCLFFBQVEsRUFBRSxXQUFXO29CQUNyQixZQUFZLEVBQUUsa0JBQWtCLENBQUMsYUFBYSxDQUFDO2lCQUNoRCxFQUNELG1CQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUNoQjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFFTSxpQkFBaUI7UUFDdEIsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUM3RCxDQUFDO0NBQ0Y7QUFwQ0QsZ0RBb0NDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXJuLCBTdGFjayB9IGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0ICogYXMgQ3VzdG9tUmVzb3VyY2UgZnJvbSBcImF3cy1jZGstbGliL2N1c3RvbS1yZXNvdXJjZXNcIjtcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5cbmludGVyZmFjZSBTU01QYXJhbWV0ZXJSZWFkZXJQcm9wcyB7XG4gIHBhcmFtZXRlck5hbWU6IHN0cmluZztcbiAgcmVnaW9uOiBzdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUxlYWRpbmdTbGFzaCh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHZhbHVlLnNsaWNlKDAsIDEpID09IFwiL1wiID8gdmFsdWUuc2xpY2UoMSkgOiB2YWx1ZTtcbn1cbmV4cG9ydCBjbGFzcyBTU01QYXJhbWV0ZXJSZWFkZXIgZXh0ZW5kcyBDdXN0b21SZXNvdXJjZS5Bd3NDdXN0b21SZXNvdXJjZSB7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIG5hbWU6IHN0cmluZywgcHJvcHM6IFNTTVBhcmFtZXRlclJlYWRlclByb3BzKSB7XG4gICAgY29uc3QgeyBwYXJhbWV0ZXJOYW1lLCByZWdpb24gfSA9IHByb3BzO1xuXG4gICAgY29uc3Qgc3NtQXdzU2RrQ2FsbDogQ3VzdG9tUmVzb3VyY2UuQXdzU2RrQ2FsbCA9IHtcbiAgICAgIHNlcnZpY2U6IFwiU1NNXCIsXG4gICAgICBhY3Rpb246IFwiZ2V0UGFyYW1ldGVyXCIsXG4gICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgIE5hbWU6IHBhcmFtZXRlck5hbWUsXG4gICAgICB9LFxuICAgICAgcmVnaW9uLFxuICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBDdXN0b21SZXNvdXJjZS5QaHlzaWNhbFJlc291cmNlSWQub2YoXG4gICAgICAgIERhdGUubm93KCkudG9TdHJpbmcoKVxuICAgICAgKSxcbiAgICB9O1xuXG4gICAgY29uc3Qgc3NtQ3JQb2xpY3kgPSBDdXN0b21SZXNvdXJjZS5Bd3NDdXN0b21SZXNvdXJjZVBvbGljeS5mcm9tU2RrQ2FsbHMoe1xuICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgIEFybi5mb3JtYXQoXG4gICAgICAgICAge1xuICAgICAgICAgICAgc2VydmljZTogXCJzc21cIixcbiAgICAgICAgICAgIHJlZ2lvbjogcHJvcHMucmVnaW9uLFxuICAgICAgICAgICAgcmVzb3VyY2U6IFwicGFyYW1ldGVyXCIsXG4gICAgICAgICAgICByZXNvdXJjZU5hbWU6IHJlbW92ZUxlYWRpbmdTbGFzaChwYXJhbWV0ZXJOYW1lKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFN0YWNrLm9mKHNjb3BlKVxuICAgICAgICApLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIHN1cGVyKHNjb3BlLCBuYW1lLCB7IG9uVXBkYXRlOiBzc21Bd3NTZGtDYWxsLCBwb2xpY3k6IHNzbUNyUG9saWN5IH0pO1xuICB9XG5cbiAgcHVibGljIGdldFBhcmFtZXRlclZhbHVlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UmVzcG9uc2VGaWVsZChcIlBhcmFtZXRlci5WYWx1ZVwiKS50b1N0cmluZygpO1xuICB9XG59XG4iXX0=