"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ApiStack = void 0;
const aws_cdk_lib_1 = require("aws-cdk-lib");
const cognito_1 = require("./constructs/cognito");
const api_1 = require("./constructs/api");
const path = require("path");
class ApiStack extends aws_cdk_lib_1.Stack {
    constructor(scope, id, props) {
        const { cognito, vpc, cluster, clusterRole, graphqlFieldName, s3Uri } = props;
        super(scope, id, props);
        this.cognito = new cognito_1.Cognito(this, "cognito", {
            adminEmail: cognito.adminEmail,
            userName: cognito.userName,
            refreshTokenValidity: aws_cdk_lib_1.Duration.days(1),
        });
        const api = new api_1.Api(this, "api", {
            schema: path.join(__dirname, "../api/graphql/schema.graphql"),
            vpc,
            cluster,
            clusterRole,
            cognito: this.cognito,
            graphqlFieldName,
            s3Uri,
        });
        this.graphqlUrl = api.graphqlUrl;
        this.graphqlApiId = api.graphqlApiId;
        this.lambdaFunctionNames = api.lambdaFunctionNames;
    }
}
exports.ApiStack = ApiStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBpLXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZDQUE0RTtBQUc1RSxrREFBK0M7QUFFL0MsMENBQThDO0FBQzlDLDZCQUE2QjtBQWM3QixNQUFhLFFBQVMsU0FBUSxtQkFBSztJQUtqQyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQW9CO1FBQzVELE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsS0FBSyxFQUFFLEdBQ25FLEtBQUssQ0FBQztRQUNSLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxpQkFBTyxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUU7WUFDMUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO1lBQzlCLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtZQUMxQixvQkFBb0IsRUFBRSxzQkFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDdkMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxHQUFHLEdBQUcsSUFBSSxTQUFHLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRTtZQUMvQixNQUFNLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsK0JBQStCLENBQUM7WUFDN0QsR0FBRztZQUNILE9BQU87WUFDUCxXQUFXO1lBQ1gsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLGdCQUFnQjtZQUNoQixLQUFLO1NBQ04sQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQztRQUNyQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsR0FBRyxDQUFDLG1CQUFtQixDQUFDO0lBQ3JELENBQUM7Q0FDRjtBQTNCRCw0QkEyQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdGFjaywgU3RhY2tQcm9wcywgRHVyYXRpb24sIGF3c19lYzIsIGF3c19pYW0gfSBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5cbmltcG9ydCB7IENvZ25pdG8gfSBmcm9tIFwiLi9jb25zdHJ1Y3RzL2NvZ25pdG9cIjtcbmltcG9ydCAqIGFzIG5lcHR1bmUgZnJvbSBcIkBhd3MtY2RrL2F3cy1uZXB0dW5lLWFscGhhXCI7XG5pbXBvcnQgeyBBcGksIFMzVXJpIH0gZnJvbSBcIi4vY29uc3RydWN0cy9hcGlcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcblxuaW50ZXJmYWNlIEFwaVN0YWNrUHJvcHMgZXh0ZW5kcyBTdGFja1Byb3BzIHtcbiAgY29nbml0bzoge1xuICAgIGFkbWluRW1haWw6IHN0cmluZztcbiAgICB1c2VyTmFtZT86IHN0cmluZztcbiAgfTtcbiAgdnBjOiBhd3NfZWMyLlZwYztcbiAgY2x1c3RlcjogbmVwdHVuZS5EYXRhYmFzZUNsdXN0ZXI7XG4gIGNsdXN0ZXJSb2xlOiBhd3NfaWFtLlJvbGU7XG4gIGdyYXBocWxGaWVsZE5hbWU6IHN0cmluZ1tdO1xuICBzM1VyaTogUzNVcmk7XG59XG5cbmV4cG9ydCBjbGFzcyBBcGlTdGFjayBleHRlbmRzIFN0YWNrIHtcbiAgcHVibGljIHJlYWRvbmx5IGNvZ25pdG86IENvZ25pdG87XG4gIHB1YmxpYyByZWFkb25seSBncmFwaHFsVXJsOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBncmFwaHFsQXBpSWQ6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGxhbWJkYUZ1bmN0aW9uTmFtZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBBcGlTdGFja1Byb3BzKSB7XG4gICAgY29uc3QgeyBjb2duaXRvLCB2cGMsIGNsdXN0ZXIsIGNsdXN0ZXJSb2xlLCBncmFwaHFsRmllbGROYW1lLCBzM1VyaSB9ID1cbiAgICAgIHByb3BzO1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuICAgIHRoaXMuY29nbml0byA9IG5ldyBDb2duaXRvKHRoaXMsIFwiY29nbml0b1wiLCB7XG4gICAgICBhZG1pbkVtYWlsOiBjb2duaXRvLmFkbWluRW1haWwsXG4gICAgICB1c2VyTmFtZTogY29nbml0by51c2VyTmFtZSxcbiAgICAgIHJlZnJlc2hUb2tlblZhbGlkaXR5OiBEdXJhdGlvbi5kYXlzKDEpLFxuICAgIH0pO1xuICAgIGNvbnN0IGFwaSA9IG5ldyBBcGkodGhpcywgXCJhcGlcIiwge1xuICAgICAgc2NoZW1hOiBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2FwaS9ncmFwaHFsL3NjaGVtYS5ncmFwaHFsXCIpLFxuICAgICAgdnBjLFxuICAgICAgY2x1c3RlcixcbiAgICAgIGNsdXN0ZXJSb2xlLFxuICAgICAgY29nbml0bzogdGhpcy5jb2duaXRvLFxuICAgICAgZ3JhcGhxbEZpZWxkTmFtZSxcbiAgICAgIHMzVXJpLFxuICAgIH0pO1xuICAgIHRoaXMuZ3JhcGhxbFVybCA9IGFwaS5ncmFwaHFsVXJsO1xuICAgIHRoaXMuZ3JhcGhxbEFwaUlkID0gYXBpLmdyYXBocWxBcGlJZDtcbiAgICB0aGlzLmxhbWJkYUZ1bmN0aW9uTmFtZXMgPSBhcGkubGFtYmRhRnVuY3Rpb25OYW1lcztcbiAgfVxufVxuIl19