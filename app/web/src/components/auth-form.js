"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UserAuthForm = UserAuthForm;
const react_1 = require("react");
const react_router_1 = require("@tanstack/react-router");
const auth_1 = require("aws-amplify/auth");
const utils_1 = require("@/lib/utils");
const button_1 = require("@/components/ui/button");
const input_1 = require("@/components/ui/input");
const label_1 = require("@/components/ui/label");
const use_toast_1 = require("@/components/ui/use-toast");
const useAuthStore_1 = require("@/store/useAuthStore");
function UserAuthForm({ className, ...props }) {
    const [isLoading, setIsLoading] = (0, react_1.useState)(false);
    const [isOpen, setIsOpen] = (0, react_1.useState)(false);
    const [isRecoveryOpen, setIsRecoveryOpen] = (0, react_1.useState)(false);
    const refUser = (0, react_1.useRef)(null);
    const refPassword = (0, react_1.useRef)(null);
    const refEmail = (0, react_1.useRef)(null);
    const refCode = (0, react_1.useRef)(null);
    const refNewPassword = (0, react_1.useRef)(null);
    const [resetEmail, setResetEmail] = (0, react_1.useState)("");
    const { toast } = (0, use_toast_1.useToast)();
    const setUser = (0, useAuthStore_1.useAuthStore)((state) => state.setUser);
    const setIsAuthenticated = (0, useAuthStore_1.useAuthStore)((state) => state.setIsAuthenticated);
    const setSignInStep = (0, useAuthStore_1.useAuthStore)((state) => state.setSignInStep);
    const setCredential = (0, useAuthStore_1.useCredentialStore)((state) => state.setCredential);
    const navigate = (0, react_router_1.useNavigate)();
    const onSubmit = async (event) => {
        event.preventDefault();
        setIsLoading(true);
        if (!refUser.current?.value) {
            return;
        }
        if (!refPassword.current?.value) {
            return;
        }
        const username = refUser.current.value;
        const password = refPassword.current.value;
        try {
            await (0, auth_1.signOut)({ global: true });
            const { nextStep, isSignedIn } = await (0, auth_1.signIn)({
                username,
                password,
            });
            if (nextStep.signInStep !== "CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED") {
                const { username } = await (0, auth_1.getCurrentUser)();
                setUser(username);
                setIsAuthenticated(isSignedIn);
                setSignInStep(nextStep.signInStep);
                const { credentials } = await (0, auth_1.fetchAuthSession)();
                setCredential(credentials);
                toast({
                    title: "Success",
                    description: "Sign-in was successful",
                });
                navigate({ to: "/" });
            }
            setUser(username);
            setSignInStep(nextStep.signInStep);
        }
        catch (error) {
            console.log(error);
            const errorMessage = error;
            toast({
                variant: "destructive",
                title: "Sign-in error",
                description: errorMessage.message,
            });
            setIsLoading(false);
        }
    };
    const onSubmitReset = async (event) => {
        event.preventDefault();
        setIsLoading(true);
        try {
            await (0, auth_1.resetPassword)({
                username: refEmail.current.value,
            });
            setIsOpen(!isOpen);
            setIsLoading(false);
            setResetEmail(refEmail.current.value);
            setIsRecoveryOpen(!isRecoveryOpen);
        }
        catch (error) {
            setIsLoading(false);
            const errorMessage = error;
            toast({
                variant: "destructive",
                title: "Failed to reset password",
                description: errorMessage.message,
            });
        }
    };
    const onSubmitRecovery = async (event) => {
        event.preventDefault();
        setIsLoading(true);
        try {
            await (0, auth_1.confirmResetPassword)({
                username: resetEmail,
                confirmationCode: refCode.current.value,
                newPassword: refNewPassword.current.value,
            });
            setIsRecoveryOpen(!isRecoveryOpen);
            setIsLoading(false);
            toast({
                title: "Reset password successfully",
                description: "Try to sign in with your new password",
            });
        }
        catch (error) {
            setIsLoading(false);
            const errorMessage = error;
            toast({
                variant: "destructive",
                title: "Failed to reset password",
                description: errorMessage.message,
            });
        }
    };
    return (<div className={(0, utils_1.cn)("grid gap-6", className)} {...props}>
      <form onSubmit={onSubmit} className="space-y-4">
        <div className="grid gap-2 ">
          <label_1.Label htmlFor="email" className="text-left">
            Username/Email
          </label_1.Label>
          <input_1.Input id="user" placeholder="Username or your email" required={true} autoCapitalize="none" autoCorrect="off" disabled={isLoading} ref={refUser}/>
        </div>
        <div className="grid gap-2">
          <label_1.Label className="text-left" htmlFor="password">
            Password
          </label_1.Label>
          <input_1.Input id="password" placeholder="Your password" type="password" autoCorrect="off" required={true} disabled={isLoading} ref={refPassword}/>
          <button_1.Button disabled={isLoading}>
            {isLoading && (<utils_1.Icons.spinner className="mr-2 h-4 w-4 animate-spin"/>)}
            Sign in
          </button_1.Button>
        </div>
      </form>
      <div className="relative">
        <div className="absolute inset-0 flex items-center">
          <span className="w-full border-t"/>
        </div>

        <div className="relative flex justify-center text-xs uppercase">
          <span className="bg-background px-2 text-muted-foreground">
            Or forgot password with
          </span>
        </div>
      </div>
      <button_1.Button variant="outline" type="button" disabled={isLoading} onClick={() => setIsOpen(!isOpen)}>
        Reset your password
      </button_1.Button>

      {isOpen ? (<form onSubmit={onSubmitReset}>
          <div className="grid gap-2">
            <div className="grid gap-1">
              <label_1.Label className="sr-only" htmlFor="email">
                Email
              </label_1.Label>
              <input_1.Input id="email" placeholder="sample@example.com" type="email" required={true} autoCapitalize="none" autoComplete="email" autoCorrect="off" disabled={isLoading} ref={refEmail}/>
            </div>
            <button_1.Button disabled={isLoading}>
              {isLoading && (<utils_1.Icons.spinner className="mr-2 h-4 w-4 animate-spin"/>)}
              Submit
            </button_1.Button>
          </div>
        </form>) : (<></>)}
      {isRecoveryOpen ? (<>
          <form onSubmit={onSubmitRecovery}>
            <div className="grid gap-2">
              <div className="grid gap-1">
                <label_1.Label className="sr-only" htmlFor="code">
                  Email
                </label_1.Label>
                <input_1.Input id="code" placeholder="Your code from your email" type="code" required={true} autoCapitalize="none" autoCorrect="off" disabled={isLoading} ref={refCode}/>
                <label_1.Label className="sr-only" htmlFor="new_password">
                  Password
                </label_1.Label>
                <input_1.Input id="new_password" placeholder="Your new password" type="password" autoCorrect="off" required={true} disabled={isLoading} ref={refNewPassword}/>
              </div>
              <button_1.Button disabled={isLoading}>
                {isLoading && (<utils_1.Icons.spinner className="mr-2 h-4 w-4 animate-spin"/>)}
                Submit
              </button_1.Button>
            </div>
          </form>
        </>) : (<></>)}
    </div>);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC1mb3JtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXV0aC1mb3JtLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQW9CQSxvQ0F5UEM7QUE3UUQsaUNBQWdEO0FBQ2hELHlEQUFxRDtBQUNyRCwyQ0FPMEI7QUFDMUIsdUNBQXdDO0FBQ3hDLG1EQUFnRDtBQUNoRCxpREFBOEM7QUFDOUMsaURBQThDO0FBRTlDLHlEQUFxRDtBQUNyRCx1REFBd0U7QUFJeEUsU0FBZ0IsWUFBWSxDQUFDLEVBQUUsU0FBUyxFQUFFLEdBQUcsS0FBSyxFQUFxQjtJQUNyRSxNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBVSxLQUFLLENBQUMsQ0FBQztJQUMzRCxNQUFNLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBVSxLQUFLLENBQUMsQ0FBQztJQUNyRCxNQUFNLENBQUMsY0FBYyxFQUFFLGlCQUFpQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFVLEtBQUssQ0FBQyxDQUFDO0lBRXJFLE1BQU0sT0FBTyxHQUFHLElBQUEsY0FBTSxFQUFtQixJQUFJLENBQUMsQ0FBQztJQUMvQyxNQUFNLFdBQVcsR0FBRyxJQUFBLGNBQU0sRUFBbUIsSUFBSSxDQUFDLENBQUM7SUFDbkQsTUFBTSxRQUFRLEdBQUcsSUFBQSxjQUFNLEVBQW1CLElBQUksQ0FBQyxDQUFDO0lBQ2hELE1BQU0sT0FBTyxHQUFHLElBQUEsY0FBTSxFQUFtQixJQUFJLENBQUMsQ0FBQztJQUMvQyxNQUFNLGNBQWMsR0FBRyxJQUFBLGNBQU0sRUFBbUIsSUFBSSxDQUFDLENBQUM7SUFFdEQsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDakQsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLElBQUEsb0JBQVEsR0FBRSxDQUFDO0lBQzdCLE1BQU0s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YWN0LCB7IHVzZVJlZiwgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHVzZU5hdmlnYXRlIH0gZnJvbSBcIkB0YW5zdGFjay9yZWFjdC1yb3V0ZXJcIjtcbmltcG9ydCB7XG4gIGNvbmZpcm1SZXNldFBhc3N3b3JkLFxuICBmZXRjaEF1dGhTZXNzaW9uLFxuICBnZXRDdXJyZW50VXNlcixcbiAgcmVzZXRQYXNzd29yZCxcbiAgc2lnbkluLFxuICBzaWduT3V0LFxufSBmcm9tIFwiYXdzLWFtcGxpZnkvYXV0aFwiO1xuaW1wb3J0IHsgSWNvbnMsIGNuIH0gZnJvbSBcIkAvbGliL3V0aWxzXCI7XG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tIFwiQC9jb21wb25lbnRzL3VpL2J1dHRvblwiO1xuaW1wb3J0IHsgSW5wdXQgfSBmcm9tIFwiQC9jb21wb25lbnRzL3VpL2lucHV0XCI7XG5pbXBvcnQgeyBMYWJlbCB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvbGFiZWxcIjtcbmltcG9ydCB7IEVycm9yTWVzc2FnZSB9IGZyb20gXCJAL3R5cGVzL3R5cGVzXCI7XG5pbXBvcnQgeyB1c2VUb2FzdCB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvdXNlLXRvYXN0XCI7XG5pbXBvcnQgeyB1c2VBdXRoU3RvcmUsIHVzZUNyZWRlbnRpYWxTdG9yZSB9IGZyb20gXCJAL3N0b3JlL3VzZUF1dGhTdG9yZVwiO1xuXG5pbnRlcmZhY2UgVXNlckF1dGhGb3JtUHJvcHMgZXh0ZW5kcyBSZWFjdC5IVE1MQXR0cmlidXRlczxIVE1MRGl2RWxlbWVudD4ge31cblxuZXhwb3J0IGZ1bmN0aW9uIFVzZXJBdXRoRm9ybSh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfTogVXNlckF1dGhGb3JtUHJvcHMpIHtcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKTtcbiAgY29uc3QgW2lzT3Blbiwgc2V0SXNPcGVuXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKTtcbiAgY29uc3QgW2lzUmVjb3ZlcnlPcGVuLCBzZXRJc1JlY292ZXJ5T3Blbl0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSk7XG5cbiAgY29uc3QgcmVmVXNlciA9IHVzZVJlZjxIVE1MSW5wdXRFbGVtZW50PihudWxsKTtcbiAgY29uc3QgcmVmUGFzc3dvcmQgPSB1c2VSZWY8SFRNTElucHV0RWxlbWVudD4obnVsbCk7XG4gIGNvbnN0IHJlZkVtYWlsID0gdXNlUmVmPEhUTUxJbnB1dEVsZW1lbnQ+KG51bGwpO1xuICBjb25zdCByZWZDb2RlID0gdXNlUmVmPEhUTUxJbnB1dEVsZW1lbnQ+KG51bGwpO1xuICBjb25zdCByZWZOZXdQYXNzd29yZCA9IHVzZVJlZjxIVE1MSW5wdXRFbGVtZW50PihudWxsKTtcblxuICBjb25zdCBbcmVzZXRFbWFpbCwgc2V0UmVzZXRFbWFpbF0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgY29uc3QgeyB0b2FzdCB9ID0gdXNlVG9hc3QoKTtcbiAgY29uc3Qgc2V0VXNlciA9IHVzZUF1dGhTdG9yZSgoc3RhdGUpID0+IHN0YXRlLnNldFVzZXIpO1xuICBjb25zdCBzZXRJc0F1dGhlbnRpY2F0ZWQgPSB1c2VBdXRoU3RvcmUoKHN0YXRlKSA9PiBzdGF0ZS5zZXRJc0F1dGhlbnRpY2F0ZWQpO1xuICBjb25zdCBzZXRTaWduSW5TdGVwID0gdXNlQXV0aFN0b3JlKChzdGF0ZSkgPT4gc3RhdGUuc2V0U2lnbkluU3RlcCk7XG4gIGNvbnN0IHNldENyZWRlbnRpYWwgPSB1c2VDcmVkZW50aWFsU3RvcmUoKHN0YXRlKSA9PiBzdGF0ZS5zZXRDcmVkZW50aWFsKTtcbiAgY29uc3QgbmF2aWdhdGUgPSB1c2VOYXZpZ2F0ZSgpO1xuICBjb25zdCBvblN1Ym1pdCA9IGFzeW5jIChldmVudDogUmVhY3QuU3ludGhldGljRXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHNldElzTG9hZGluZyh0cnVlKTtcbiAgICBpZiAoIXJlZlVzZXIuY3VycmVudD8udmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFyZWZQYXNzd29yZC5jdXJyZW50Py52YWx1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJuYW1lID0gcmVmVXNlci5jdXJyZW50IS52YWx1ZTtcbiAgICBjb25zdCBwYXNzd29yZCA9IHJlZlBhc3N3b3JkLmN1cnJlbnQhLnZhbHVlO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzaWduT3V0KHsgZ2xvYmFsOiB0cnVlIH0pO1xuXG4gICAgICBjb25zdCB7IG5leHRTdGVwLCBpc1NpZ25lZEluIH0gPSBhd2FpdCBzaWduSW4oe1xuICAgICAgICB1c2VybmFtZSxcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICB9KTtcblxuICAgICAgaWYgKFxuICAgICAgICBuZXh0U3RlcC5zaWduSW5TdGVwICE9PSBcIkNPTkZJUk1fU0lHTl9JTl9XSVRIX05FV19QQVNTV09SRF9SRVFVSVJFRFwiXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgeyB1c2VybmFtZSB9ID0gYXdhaXQgZ2V0Q3VycmVudFVzZXIoKTtcbiAgICAgICAgc2V0VXNlcih1c2VybmFtZSk7XG4gICAgICAgIHNldElzQXV0aGVudGljYXRlZChpc1NpZ25lZEluKTtcbiAgICAgICAgc2V0U2lnbkluU3RlcChuZXh0U3RlcC5zaWduSW5TdGVwKTtcbiAgICAgICAgY29uc3QgeyBjcmVkZW50aWFscyB9ID0gYXdhaXQgZmV0Y2hBdXRoU2Vzc2lvbigpO1xuICAgICAgICBzZXRDcmVkZW50aWFsKGNyZWRlbnRpYWxzKTtcblxuICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgdGl0bGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlNpZ24taW4gd2FzIHN1Y2Nlc3NmdWxcIixcbiAgICAgICAgfSk7XG4gICAgICAgIG5hdmlnYXRlKHsgdG86IFwiL1wiIH0pO1xuICAgICAgfVxuICAgICAgc2V0VXNlcih1c2VybmFtZSk7XG4gICAgICBzZXRTaWduSW5TdGVwKG5leHRTdGVwLnNpZ25JblN0ZXApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBhcyBFcnJvck1lc3NhZ2U7XG4gICAgICB0b2FzdCh7XG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICAgICAgdGl0bGU6IFwiU2lnbi1pbiBlcnJvclwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogZXJyb3JNZXNzYWdlLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IG9uU3VibWl0UmVzZXQgPSBhc3luYyAoZXZlbnQ6IFJlYWN0LlN5bnRoZXRpY0V2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJlc2V0UGFzc3dvcmQoe1xuICAgICAgICB1c2VybmFtZTogcmVmRW1haWwuY3VycmVudCEudmFsdWUsXG4gICAgICB9KTtcbiAgICAgIHNldElzT3BlbighaXNPcGVuKTtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgICBzZXRSZXNldEVtYWlsKHJlZkVtYWlsLmN1cnJlbnQhLnZhbHVlKTtcbiAgICAgIHNldElzUmVjb3ZlcnlPcGVuKCFpc1JlY292ZXJ5T3Blbik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBhcyBFcnJvck1lc3NhZ2U7XG4gICAgICB0b2FzdCh7XG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICAgICAgdGl0bGU6IFwiRmFpbGVkIHRvIHJlc2V0IHBhc3N3b3JkXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBlcnJvck1lc3NhZ2UubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBvblN1Ym1pdFJlY292ZXJ5ID0gYXN5bmMgKGV2ZW50OiBSZWFjdC5TeW50aGV0aWNFdmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjb25maXJtUmVzZXRQYXNzd29yZCh7XG4gICAgICAgIHVzZXJuYW1lOiByZXNldEVtYWlsLFxuICAgICAgICBjb25maXJtYXRpb25Db2RlOiByZWZDb2RlLmN1cnJlbnQhLnZhbHVlLFxuICAgICAgICBuZXdQYXNzd29yZDogcmVmTmV3UGFzc3dvcmQuY3VycmVudCEudmFsdWUsXG4gICAgICB9KTtcbiAgICAgIHNldElzUmVjb3ZlcnlPcGVuKCFpc1JlY292ZXJ5T3Blbik7XG4gICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgICAgdG9hc3Qoe1xuICAgICAgICB0aXRsZTogXCJSZXNldCBwYXNzd29yZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVHJ5IHRvIHNpZ24gaW4gd2l0aCB5b3VyIG5ldyBwYXNzd29yZFwiLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBhcyBFcnJvck1lc3NhZ2U7XG4gICAgICB0b2FzdCh7XG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICAgICAgdGl0bGU6IFwiRmFpbGVkIHRvIHJlc2V0IHBhc3N3b3JkXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBlcnJvck1lc3NhZ2UubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtjbihcImdyaWQgZ2FwLTZcIiwgY2xhc3NOYW1lKX0gey4uLnByb3BzfT5cbiAgICAgIDxmb3JtIG9uU3VibWl0PXtvblN1Ym1pdH0gY2xhc3NOYW1lPVwic3BhY2UteS00XCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ3JpZCBnYXAtMiBcIj5cbiAgICAgICAgICA8TGFiZWwgaHRtbEZvcj1cImVtYWlsXCIgY2xhc3NOYW1lPVwidGV4dC1sZWZ0XCI+XG4gICAgICAgICAgICBVc2VybmFtZS9FbWFpbFxuICAgICAgICAgIDwvTGFiZWw+XG4gICAgICAgICAgPElucHV0XG4gICAgICAgICAgICBpZD1cInVzZXJcIlxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJVc2VybmFtZSBvciB5b3VyIGVtYWlsXCJcbiAgICAgICAgICAgIHJlcXVpcmVkPXt0cnVlfVxuICAgICAgICAgICAgYXV0b0NhcGl0YWxpemU9XCJub25lXCJcbiAgICAgICAgICAgIGF1dG9Db3JyZWN0PVwib2ZmXCJcbiAgICAgICAgICAgIGRpc2FibGVkPXtpc0xvYWRpbmd9XG4gICAgICAgICAgICByZWY9e3JlZlVzZXJ9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ3JpZCBnYXAtMlwiPlxuICAgICAgICAgIDxMYWJlbCBjbGFzc05hbWU9XCJ0ZXh0LWxlZnRcIiBodG1sRm9yPVwicGFzc3dvcmRcIj5cbiAgICAgICAgICAgIFBhc3N3b3JkXG4gICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgIGlkPVwicGFzc3dvcmRcIlxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJZb3VyIHBhc3N3b3JkXCJcbiAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICBhdXRvQ29ycmVjdD1cIm9mZlwiXG4gICAgICAgICAgICByZXF1aXJlZD17dHJ1ZX1cbiAgICAgICAgICAgIGRpc2FibGVkPXtpc0xvYWRpbmd9XG4gICAgICAgICAgICByZWY9e3JlZlBhc3N3b3JkfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPEJ1dHRvbiBkaXNhYmxlZD17aXNMb2FkaW5nfT5cbiAgICAgICAgICAgIHtpc0xvYWRpbmcgJiYgKFxuICAgICAgICAgICAgICA8SWNvbnMuc3Bpbm5lciBjbGFzc05hbWU9XCJtci0yIGgtNCB3LTQgYW5pbWF0ZS1zcGluXCIgLz5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICBTaWduIGluXG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9mb3JtPlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZWxhdGl2ZVwiPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImFic29sdXRlIGluc2V0LTAgZmxleCBpdGVtcy1jZW50ZXJcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ3LWZ1bGwgYm9yZGVyLXRcIiAvPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInJlbGF0aXZlIGZsZXgganVzdGlmeS1jZW50ZXIgdGV4dC14cyB1cHBlcmNhc2VcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJiZy1iYWNrZ3JvdW5kIHB4LTIgdGV4dC1tdXRlZC1mb3JlZ3JvdW5kXCI+XG4gICAgICAgICAgICBPciBmb3Jnb3QgcGFzc3dvcmQgd2l0aFxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxCdXR0b25cbiAgICAgICAgdmFyaWFudD1cIm91dGxpbmVcIlxuICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgZGlzYWJsZWQ9e2lzTG9hZGluZ31cbiAgICAgICAgb25DbGljaz17KCkgPT4gc2V0SXNPcGVuKCFpc09wZW4pfVxuICAgICAgPlxuICAgICAgICBSZXNldCB5b3VyIHBhc3N3b3JkXG4gICAgICA8L0J1dHRvbj5cblxuICAgICAge2lzT3BlbiA/IChcbiAgICAgICAgPGZvcm0gb25TdWJtaXQ9e29uU3VibWl0UmVzZXR9PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ3JpZCBnYXAtMlwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJncmlkIGdhcC0xXCI+XG4gICAgICAgICAgICAgIDxMYWJlbCBjbGFzc05hbWU9XCJzci1vbmx5XCIgaHRtbEZvcj1cImVtYWlsXCI+XG4gICAgICAgICAgICAgICAgRW1haWxcbiAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgICAgPElucHV0XG4gICAgICAgICAgICAgICAgaWQ9XCJlbWFpbFwiXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJzYW1wbGVAZXhhbXBsZS5jb21cIlxuICAgICAgICAgICAgICAgIHR5cGU9XCJlbWFpbFwiXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ9e3RydWV9XG4gICAgICAgICAgICAgICAgYXV0b0NhcGl0YWxpemU9XCJub25lXCJcbiAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJlbWFpbFwiXG4gICAgICAgICAgICAgICAgYXV0b0NvcnJlY3Q9XCJvZmZcIlxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc0xvYWRpbmd9XG4gICAgICAgICAgICAgICAgcmVmPXtyZWZFbWFpbH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPEJ1dHRvbiBkaXNhYmxlZD17aXNMb2FkaW5nfT5cbiAgICAgICAgICAgICAge2lzTG9hZGluZyAmJiAoXG4gICAgICAgICAgICAgICAgPEljb25zLnNwaW5uZXIgY2xhc3NOYW1lPVwibXItMiBoLTQgdy00IGFuaW1hdGUtc3BpblwiIC8+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIFN1Ym1pdFxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZm9ybT5cbiAgICAgICkgOiAoXG4gICAgICAgIDw+PC8+XG4gICAgICApfVxuICAgICAge2lzUmVjb3ZlcnlPcGVuID8gKFxuICAgICAgICA8PlxuICAgICAgICAgIDxmb3JtIG9uU3VibWl0PXtvblN1Ym1pdFJlY292ZXJ5fT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ3JpZCBnYXAtMlwiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImdyaWQgZ2FwLTFcIj5cbiAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPVwic3Itb25seVwiIGh0bWxGb3I9XCJjb2RlXCI+XG4gICAgICAgICAgICAgICAgICBFbWFpbFxuICAgICAgICAgICAgICAgIDwvTGFiZWw+XG4gICAgICAgICAgICAgICAgPElucHV0XG4gICAgICAgICAgICAgICAgICBpZD1cImNvZGVcIlxuICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJZb3VyIGNvZGUgZnJvbSB5b3VyIGVtYWlsXCJcbiAgICAgICAgICAgICAgICAgIHR5cGU9XCJjb2RlXCJcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgYXV0b0NhcGl0YWxpemU9XCJub25lXCJcbiAgICAgICAgICAgICAgICAgIGF1dG9Db3JyZWN0PVwib2ZmXCJcbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc0xvYWRpbmd9XG4gICAgICAgICAgICAgICAgICByZWY9e3JlZkNvZGV9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPVwic3Itb25seVwiIGh0bWxGb3I9XCJuZXdfcGFzc3dvcmRcIj5cbiAgICAgICAgICAgICAgICAgIFBhc3N3b3JkXG4gICAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgICAgICAgIGlkPVwibmV3X3Bhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiWW91ciBuZXcgcGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICAgIGF1dG9Db3JyZWN0PVwib2ZmXCJcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2lzTG9hZGluZ31cbiAgICAgICAgICAgICAgICAgIHJlZj17cmVmTmV3UGFzc3dvcmR9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDxCdXR0b24gZGlzYWJsZWQ9e2lzTG9hZGluZ30+XG4gICAgICAgICAgICAgICAge2lzTG9hZGluZyAmJiAoXG4gICAgICAgICAgICAgICAgICA8SWNvbnMuc3Bpbm5lciBjbGFzc05hbWU9XCJtci0yIGgtNCB3LTQgYW5pbWF0ZS1zcGluXCIgLz5cbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgIFN1Ym1pdFxuICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgPC8+XG4gICAgICApIDogKFxuICAgICAgICA8PjwvPlxuICAgICAgKX1cbiAgICA8L2Rpdj5cbiAgKTtcbn1cbiJdfQ==