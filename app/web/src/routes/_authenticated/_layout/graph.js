"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Route = void 0;
const react_1 = require("react");
const three_spritetext_1 = require("three-spritetext");
const react_force_graph_3d_1 = require("react-force-graph-3d");
const react_router_1 = require("@tanstack/react-router");
const lodash_es_1 = require("lodash-es");
const sheet_1 = require("@/components/ui/sheet");
const separator_1 = require("@/components/ui/separator");
const data_1 = require("@/data/data");
const utils_1 = require("@/lib/utils");
const use_toast_1 = require("@/components/ui/use-toast");
const skeleton_1 = require("@/components/ui/skeleton");
exports.Route = (0, react_router_1.createFileRoute)("/_authenticated/_layout/graph")({
    component: Graph3D,
});
function Graph3D() {
    const [value] = (0, react_1.useState)("id");
    const [name, setName] = (0, react_1.useState)("");
    const [state, setState] = (0, react_1.useState)({ nodes: [], links: [] });
    const [profile, setProfile] = (0, react_1.useState)([]);
    const [open, setOpen] = (0, react_1.useState)(false);
    const [displayWidth, setDisplayWidth] = (0, react_1.useState)(window.innerWidth);
    const [displayHeight, setDisplayHeight] = (0, react_1.useState)(window.innerHeight);
    const [isLoading, setIsLoading] = (0, react_1.useState)(false);
    window.addEventListener("resize", () => {
        setDisplayWidth(window.innerWidth);
        setDisplayHeight(window.innerHeight);
    });
    const onSubmit = async () => {
        try {
            const res = await (0, utils_1.queryGetGraph)(value);
            setState(res.data.getGraph);
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
        }
        catch (error) {
            (0, use_toast_1.toast)({
                variant: "destructive",
                title: "Query Error",
                description: error.errors[0].message,
            });
        }
    };
    const getInformation = async () => {
        try {
            setIsLoading(true);
            const res = await (0, utils_1.queryGetProfile)(name, value);
            setProfile(res.data.getProfile);
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
        }
        catch (error) {
            console.log(error);
            setIsLoading(false);
            (0, use_toast_1.toast)({
                variant: "destructive",
                title: "Query Error",
                description: error.errors[0].message,
            });
        }
        setIsLoading(false);
    };
    (0, react_1.useEffect)(() => {
        getInformation();
    }, [name]);
    (0, react_1.useEffect)(() => {
        onSubmit();
    }, []);
    const Details = () => {
        const res = (0, lodash_es_1.omitBy)(profile[0], (value) => {
            return (0, lodash_es_1.includes)(value, "[]");
        });
        const data = [];
        (0, lodash_es_1.map)(res, (value, key) => {
            (0, lodash_es_1.find)(data_1.Profiles, (obj) => {
                if (obj.value === key) {
                    const res = { ...obj, data: value };
                    data.push(res);
                }
            });
        });
        return (<>
        <div className="flex flex-col py-8">
          {(0, lodash_es_1.map)(data, (value, index) => (<div key={index.toString()}>
              <div className="flex flex-row justify-between py-4">
                <div className="basis=1/4 font-bold">{value.description}</div>
              </div>
              <div className="basis=1/4 py-4">{(0, lodash_es_1.trim)(value.data, "[]")}</div>
              <separator_1.Separator />
            </div>))}
        </div>
      </>);
    };
    return (<main className="grid items-center flex-1 gap-4">
      <sheet_1.Sheet open={open} onOpenChange={setOpen}>
        <sheet_1.SheetContent>
          <sheet_1.SheetHeader>
            <sheet_1.SheetTitle>Relation</sheet_1.SheetTitle>
          </sheet_1.SheetHeader>
          {isLoading ? (<>
              <div className="flex flex-col space-y-3 py-8">
                <skeleton_1.Skeleton className="flex h-[100px] rounded-xl"/>
                <div className="space-y-2 ">
                  <skeleton_1.Skeleton className="flex h-4"/>
                  <skeleton_1.Skeleton className="flex h-4"/>
                </div>
              </div>
            </>) : (<>{profile.length !== 0 ? <Details /> : <></>}</>)}
        </sheet_1.SheetContent>
      </sheet_1.Sheet>
      <react_force_graph_3d_1.default graphData={state} nodeAutoColorBy={"label"} 
    // linkAutoColorBy={"label"}
    height={displayHeight} width={displayWidth} nodeLabel={"id"} onNodeClick={(event) => {
            setName(event.id);
            setOpen(true);
        }} nodeThreeObject={(node) => {
            if (typeof node.id !== "string") {
                return;
            }
            const sprite = new three_spritetext_1.default(node.id);
            sprite.color = node.color;
            sprite.textHeight = 8;
            return sprite;
        }} linkThreeObjectExtend={true}/>
    </main>
    // </div>
    );
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJncmFwaC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaUNBQTRDO0FBQzVDLHVEQUEwQztBQUMxQywrREFBZ0U7QUFDaEUseURBQXlEO0FBQ3pELHlDQUE4RDtBQUU5RCxpREFLK0I7QUFDL0IseURBQXNEO0FBQ3RELHNDQUF1QztBQUV2Qyx1Q0FBNkQ7QUFDN0QseURBQWtEO0FBQ2xELHVEQUFvRDtBQUV2QyxRQUFBLEtBQUssR0FBRyxJQUFBLDhCQUFlLEVBQUMsK0JBQStCLENBQUMsQ0FBQztJQUNwRSxTQUFTLEVBQUUsT0FBTztDQUNuQixDQUFDLENBQUM7QUFFSCxTQUFTLE9BQU87SUFDZCxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBQy9CLE1BQU0sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQVUvQixFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDN0IsTUFBTSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBVXBDLEVBQUUsQ0FBQyxDQUFDO0lBQ04sTUFBTSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEMsTUFBTSxDQUFDLFlBQVksRUFBRSxlQUFlLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3BFLE1BQU0sQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3ZFLE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFVLEtBQUssQ0FBQyxDQUFDO0lBRTNELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO1FBQ3JDLGVBQWUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDbkMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxRQUFRLEdBQUcsS0FBSyxJQUFJLEVBQUU7UUFDMUIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFBLHFCQUFhLEVBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDNUIsOERBQThEO1FBQ2hFLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLElBQUEsaUJBQUssRUFBQztnQkFDSixPQUFPLEVBQUUsYUFBYTtnQkFDdEIsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLFdBQVcsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU87YUFDckMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQztJQUNGLE1BQU0sY0FBYyxHQUFHLEtBQUssSUFBSSxFQUFFO1FBQ2hDLElBQUksQ0FBQztZQUNILFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuQixNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUEsdUJBQWUsRUFBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0MsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDaEMsOERBQThEO1FBQ2hFLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkIsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3BCLElBQUEsaUJBQUssRUFBQztnQkFDSixPQUFPLEVBQUUsYUFBYTtnQkFDdEIsS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLFdBQVcsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU87YUFDckMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUNELFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0QixDQUFDLENBQUM7SUFFRixJQUFBLGlCQUFTLEVBQUMsR0FBRyxFQUFFO1FBQ2IsY0FBYyxFQUFFLENBQUM7SUFDbkIsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUVYLElBQUEsaUJBQVMsRUFBQyxHQUFHLEVBQUU7UUFDYixRQUFRLEVBQUUsQ0FBQztJQUNiLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUVQLE1BQU0sT0FBTyxHQUFHLEdBQUcsRUFBRTtRQUNuQixNQUFNLEdBQUcsR0FBRyxJQUFBLGtCQUFNLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBYSxFQUFFLEVBQUU7WUFDL0MsT0FBTyxJQUFBLG9CQUFRLEVBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxJQUFJLEdBQVksRUFBRSxDQUFDO1FBQ3pCLElBQUEsZUFBRyxFQUFDLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUN0QixJQUFBLGdCQUFJLEVBQUMsZUFBUSxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ3JCLElBQUksR0FBRyxDQUFDLEtBQUssS0FBSyxHQUFHLEVBQUUsQ0FBQztvQkFDdEIsTUFBTSxHQUFHLEdBQUcsRUFBRSxHQUFHLEdBQUcsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUM7b0JBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2pCLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxDQUNMLEVBQ0U7UUFBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsb0JBQW9CLENBQ2pDO1VBQUEsQ0FBQyxJQUFBLGVBQUcsRUFBQyxJQUFJLEVBQUUsQ0FBQyxLQUFZLEVBQUUsS0FBYSxFQUFFLEVBQUUsQ0FBQyxDQUMxQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FDekI7Y0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsb0NBQW9DLENBQ2pEO2dCQUFBLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsRUFBRSxHQUFHLENBQy9EO2NBQUEsRUFBRSxHQUFHLENBQ0w7Y0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFBLGdCQUFJLEVBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FDN0Q7Y0FBQSxDQUFDLHFCQUFTLENBQUMsQUFBRCxFQUNaO1lBQUEsRUFBRSxHQUFHLENBQUMsQ0FDUCxDQUFDLENBQ0o7UUFBQSxFQUFFLEdBQUcsQ0FDUDtNQUFBLEdBQUcsQ0FDSixDQUFDO0lBQ0osQ0FBQyxDQUFDO0lBRUYsT0FBTyxDQUNMLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQ0FBZ0MsQ0FDOUM7TUFBQSxDQUFDLGFBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FDdkM7UUFBQSxDQUFDLG9CQUFZLENBQ1g7VUFBQSxDQUFDLG1CQUFXLENBQ1Y7WUFBQSxDQUFDLGtCQUFVLENBQUMsUUFBUSxFQUFFLGtCQUFVLENBQ2xDO1VBQUEsRUFBRSxtQkFBVyxDQUNiO1VBQUEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQ1gsRUFDRTtjQUFBLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyw4QkFBOEIsQ0FDM0M7Z0JBQUEsQ0FBQyxtQkFBUSxDQUFDLFNBQVMsQ0FBQywyQkFBMkIsRUFDL0M7Z0JBQUEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FDekI7a0JBQUEsQ0FBQyxtQkFBUSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEVBQzlCO2tCQUFBLENBQUMsbUJBQVEsQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUNoQztnQkFBQSxFQUFFLEdBQUcsQ0FDUDtjQUFBLEVBQUUsR0FBRyxDQUNQO1lBQUEsR0FBRyxDQUNKLENBQUMsQ0FBQyxDQUFDLENBQ0YsRUFBRSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxBQUFELEVBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxDQUNsRCxDQUNIO1FBQUEsRUFBRSxvQkFBWSxDQUNoQjtNQUFBLEVBQUUsYUFBSyxDQUNQO01BQUEsQ0FBQyw4QkFBWSxDQUNYLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUNqQixlQUFlLENBQUMsQ0FBQyxPQUFPLENBQUM7SUFDekIsNEJBQTRCO0lBQzVCLE1BQU0sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUN0QixLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FDcEIsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQ2hCLFdBQVcsQ0FBQyxDQUFDLENBQUMsS0FBcUIsRUFBRSxFQUFFO1lBQ3JDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEIsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUNGLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBZ0IsRUFBRSxFQUFFO1lBQ3BDLElBQUksT0FBTyxJQUFJLENBQUMsRUFBRSxLQUFLLFFBQVEsRUFBRSxDQUFDO2dCQUNoQyxPQUFPO1lBQ1QsQ0FBQztZQUNELE1BQU0sTUFBTSxHQUFHLElBQUksMEJBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQzFCLE1BQU0sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUNGLHFCQUFxQixDQUFDLENBQUMsSUFBSSxDQUFDLEVBbUJoQztJQUFBLEVBQUUsSUFBSSxDQUFDO0lBRVAsU0FBUztLQUNWLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IFNwcml0ZVRleHQgZnJvbSBcInRocmVlLXNwcml0ZXRleHRcIjtcbmltcG9ydCBGb3JjZUdyYXBoM0QsIHsgTm9kZU9iamVjdCB9IGZyb20gXCJyZWFjdC1mb3JjZS1ncmFwaC0zZFwiO1xuaW1wb3J0IHsgY3JlYXRlRmlsZVJvdXRlIH0gZnJvbSBcIkB0YW5zdGFjay9yZWFjdC1yb3V0ZXJcIjtcbmltcG9ydCB7IG9taXRCeSwgbWFwLCBpbmNsdWRlcywgdHJpbSwgZmluZCB9IGZyb20gXCJsb2Rhc2gtZXNcIjtcblxuaW1wb3J0IHtcbiAgU2hlZXQsXG4gIFNoZWV0Q29udGVudCxcbiAgU2hlZXRIZWFkZXIsXG4gIFNoZWV0VGl0bGUsXG59IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvc2hlZXRcIjtcbmltcG9ydCB7IFNlcGFyYXRvciB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvc2VwYXJhdG9yXCI7XG5pbXBvcnQgeyBQcm9maWxlcyB9IGZyb20gXCJAL2RhdGEvZGF0YVwiO1xuaW1wb3J0IHsgR3JhcGggfSBmcm9tIFwiQC90eXBlcy90eXBlc1wiO1xuaW1wb3J0IHsgcXVlcnlHZXRHcmFwaCwgcXVlcnlHZXRQcm9maWxlIH0gZnJvbSBcIkAvbGliL3V0aWxzXCI7XG5pbXBvcnQgeyB0b2FzdCB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvdXNlLXRvYXN0XCI7XG5pbXBvcnQgeyBTa2VsZXRvbiB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvc2tlbGV0b25cIjtcblxuZXhwb3J0IGNvbnN0IFJvdXRlID0gY3JlYXRlRmlsZVJvdXRlKFwiL19hdXRoZW50aWNhdGVkL19sYXlvdXQvZ3JhcGhcIikoe1xuICBjb21wb25lbnQ6IEdyYXBoM0QsXG59KTtcblxuZnVuY3Rpb24gR3JhcGgzRCgpIHtcbiAgY29uc3QgW3ZhbHVlXSA9IHVzZVN0YXRlKFwiaWRcIik7XG4gIGNvbnN0IFtuYW1lLCBzZXROYW1lXSA9IHVzZVN0YXRlKFwiXCIpO1xuICBjb25zdCBbc3RhdGUsIHNldFN0YXRlXSA9IHVzZVN0YXRlPHtcbiAgICBub2RlczogQXJyYXk8e1xuICAgICAgaWQ6IHN0cmluZztcbiAgICAgIGxhYmVsOiBzdHJpbmc7XG4gICAgfT47XG4gICAgbGlua3M6IEFycmF5PHtcbiAgICAgIHNvdXJjZTogc3RyaW5nO1xuICAgICAgdGFyZ2V0OiBzdHJpbmc7XG4gICAgICB2YWx1ZTogc3RyaW5nO1xuICAgIH0+O1xuICB9Pih7IG5vZGVzOiBbXSwgbGlua3M6IFtdIH0pO1xuICBjb25zdCBbcHJvZmlsZSwgc2V0UHJvZmlsZV0gPSB1c2VTdGF0ZTxcbiAgICBBcnJheTx7XG4gICAgICBzZWFyY2hfbmFtZTogc3RyaW5nO1xuICAgICAgdXNhZ2U/OiBzdHJpbmc7XG4gICAgICBiZWxvbmdfdG8/OiBzdHJpbmc7XG4gICAgICBhdXRob3JlZF9ieT86IHN0cmluZztcbiAgICAgIGFmZmlsaWF0ZWRfd2l0aD86IHN0cmluZztcbiAgICAgIHBlb3BsZT86IHN0cmluZztcbiAgICAgIG1hZGVfYnk/OiBzdHJpbmcgfCBudWxsO1xuICAgIH0+XG4gID4oW10pO1xuICBjb25zdCBbb3Blbiwgc2V0T3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtkaXNwbGF5V2lkdGgsIHNldERpc3BsYXlXaWR0aF0gPSB1c2VTdGF0ZSh3aW5kb3cuaW5uZXJXaWR0aCk7XG4gIGNvbnN0IFtkaXNwbGF5SGVpZ2h0LCBzZXREaXNwbGF5SGVpZ2h0XSA9IHVzZVN0YXRlKHdpbmRvdy5pbm5lckhlaWdodCk7XG4gIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgKCkgPT4ge1xuICAgIHNldERpc3BsYXlXaWR0aCh3aW5kb3cuaW5uZXJXaWR0aCk7XG4gICAgc2V0RGlzcGxheUhlaWdodCh3aW5kb3cuaW5uZXJIZWlnaHQpO1xuICB9KTtcbiAgY29uc3Qgb25TdWJtaXQgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHF1ZXJ5R2V0R3JhcGgodmFsdWUpO1xuICAgICAgc2V0U3RhdGUocmVzLmRhdGEuZ2V0R3JhcGgpO1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICB0b2FzdCh7XG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICAgICAgdGl0bGU6IFwiUXVlcnkgRXJyb3JcIixcbiAgICAgICAgZGVzY3JpcHRpb246IGVycm9yLmVycm9yc1swXS5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBnZXRJbmZvcm1hdGlvbiA9IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgcXVlcnlHZXRQcm9maWxlKG5hbWUsIHZhbHVlKTtcbiAgICAgIHNldFByb2ZpbGUocmVzLmRhdGEuZ2V0UHJvZmlsZSk7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgICB0b2FzdCh7XG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICAgICAgdGl0bGU6IFwiUXVlcnkgRXJyb3JcIixcbiAgICAgICAgZGVzY3JpcHRpb246IGVycm9yLmVycm9yc1swXS5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gIH07XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBnZXRJbmZvcm1hdGlvbigpO1xuICB9LCBbbmFtZV0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgb25TdWJtaXQoKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IERldGFpbHMgPSAoKSA9PiB7XG4gICAgY29uc3QgcmVzID0gb21pdEJ5KHByb2ZpbGVbMF0sICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICByZXR1cm4gaW5jbHVkZXModmFsdWUsIFwiW11cIik7XG4gICAgfSk7XG5cbiAgICBjb25zdCBkYXRhOiBHcmFwaFtdID0gW107XG4gICAgbWFwKHJlcywgKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgIGZpbmQoUHJvZmlsZXMsIChvYmopID0+IHtcbiAgICAgICAgaWYgKG9iai52YWx1ZSA9PT0ga2V5KSB7XG4gICAgICAgICAgY29uc3QgcmVzID0geyAuLi5vYmosIGRhdGE6IHZhbHVlIH07XG4gICAgICAgICAgZGF0YS5wdXNoKHJlcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDw+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBweS04XCI+XG4gICAgICAgICAge21hcChkYXRhLCAodmFsdWU6IEdyYXBoLCBpbmRleDogbnVtYmVyKSA9PiAoXG4gICAgICAgICAgICA8ZGl2IGtleT17aW5kZXgudG9TdHJpbmcoKX0+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LXJvdyBqdXN0aWZ5LWJldHdlZW4gcHktNFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmFzaXM9MS80IGZvbnQtYm9sZFwiPnt2YWx1ZS5kZXNjcmlwdGlvbn08L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmFzaXM9MS80IHB5LTRcIj57dHJpbSh2YWx1ZS5kYXRhLCBcIltdXCIpfTwvZGl2PlxuICAgICAgICAgICAgICA8U2VwYXJhdG9yIC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICApKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8Lz5cbiAgICApO1xuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPG1haW4gY2xhc3NOYW1lPVwiZ3JpZCBpdGVtcy1jZW50ZXIgZmxleC0xIGdhcC00XCI+XG4gICAgICA8U2hlZXQgb3Blbj17b3Blbn0gb25PcGVuQ2hhbmdlPXtzZXRPcGVufT5cbiAgICAgICAgPFNoZWV0Q29udGVudD5cbiAgICAgICAgICA8U2hlZXRIZWFkZXI+XG4gICAgICAgICAgICA8U2hlZXRUaXRsZT5SZWxhdGlvbjwvU2hlZXRUaXRsZT5cbiAgICAgICAgICA8L1NoZWV0SGVhZGVyPlxuICAgICAgICAgIHtpc0xvYWRpbmcgPyAoXG4gICAgICAgICAgICA8PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgc3BhY2UteS0zIHB5LThcIj5cbiAgICAgICAgICAgICAgICA8U2tlbGV0b24gY2xhc3NOYW1lPVwiZmxleCBoLVsxMDBweF0gcm91bmRlZC14bFwiIC8+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJzcGFjZS15LTIgXCI+XG4gICAgICAgICAgICAgICAgICA8U2tlbGV0b24gY2xhc3NOYW1lPVwiZmxleCBoLTRcIiAvPlxuICAgICAgICAgICAgICAgICAgPFNrZWxldG9uIGNsYXNzTmFtZT1cImZsZXggaC00XCIgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8Lz5cbiAgICAgICAgICApIDogKFxuICAgICAgICAgICAgPD57cHJvZmlsZS5sZW5ndGggIT09IDAgPyA8RGV0YWlscyAvPiA6IDw+PC8+fTwvPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvU2hlZXRDb250ZW50PlxuICAgICAgPC9TaGVldD5cbiAgICAgIDxGb3JjZUdyYXBoM0RcbiAgICAgICAgZ3JhcGhEYXRhPXtzdGF0ZX1cbiAgICAgICAgbm9kZUF1dG9Db2xvckJ5PXtcImxhYmVsXCJ9XG4gICAgICAgIC8vIGxpbmtBdXRvQ29sb3JCeT17XCJsYWJlbFwifVxuICAgICAgICBoZWlnaHQ9e2Rpc3BsYXlIZWlnaHR9XG4gICAgICAgIHdpZHRoPXtkaXNwbGF5V2lkdGh9XG4gICAgICAgIG5vZGVMYWJlbD17XCJpZFwifVxuICAgICAgICBvbk5vZGVDbGljaz17KGV2ZW50OiB7IGlkOiBzdHJpbmcgfSkgPT4ge1xuICAgICAgICAgIHNldE5hbWUoZXZlbnQuaWQpO1xuICAgICAgICAgIHNldE9wZW4odHJ1ZSk7XG4gICAgICAgIH19XG4gICAgICAgIG5vZGVUaHJlZU9iamVjdD17KG5vZGU6IE5vZGVPYmplY3QpID0+IHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUuaWQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgc3ByaXRlID0gbmV3IFNwcml0ZVRleHQobm9kZS5pZCk7XG4gICAgICAgICAgc3ByaXRlLmNvbG9yID0gbm9kZS5jb2xvcjtcbiAgICAgICAgICBzcHJpdGUudGV4dEhlaWdodCA9IDg7XG4gICAgICAgICAgcmV0dXJuIHNwcml0ZTtcbiAgICAgICAgfX1cbiAgICAgICAgbGlua1RocmVlT2JqZWN0RXh0ZW5kPXt0cnVlfVxuICAgICAgICAvLyAgIGxpbmtUaHJlZU9iamVjdD17KGxpbmspID0+IHtcbiAgICAgICAgLy8gICAgIC8vIGV4dGVuZCBsaW5rIHdpdGggdGV4dCBzcHJpdGVcbiAgICAgICAgLy8gICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBTcHJpdGVUZXh0KGAke2xpbmsuc291cmNlfSA+ICR7bGluay50YXJnZXR9YCk7XG4gICAgICAgIC8vICAgICBzcHJpdGUuY29sb3IgPSBcImxpZ2h0Z3JleVwiO1xuICAgICAgICAvLyAgICAgc3ByaXRlLnRleHRIZWlnaHQgPSAxLjU7XG4gICAgICAgIC8vICAgICByZXR1cm4gc3ByaXRlO1xuICAgICAgICAvLyAgIH19XG4gICAgICAgIC8vICAgbGlua1Bvc2l0aW9uVXBkYXRlPXsoc3ByaXRlLCB7IHN0YXJ0LCBlbmQgfSkgPT4ge1xuICAgICAgICAvLyAgICAgY29uc3QgbWlkZGxlUG9zID0gT2JqZWN0LmFzc2lnbihcbiAgICAgICAgLy8gICAgICAgLi4uW1wieFwiLCBcInlcIiwgXCJ6XCJdLm1hcCgoYykgPT4gKHtcbiAgICAgICAgLy8gICAgICAgICBbY106IHN0YXJ0W2NdICsgKGVuZFtjXSAtIHN0YXJ0W2NdKSAvIDIsIC8vIGNhbGMgbWlkZGxlIHBvaW50XG4gICAgICAgIC8vICAgICAgIH0pKVxuICAgICAgICAvLyAgICAgKTtcblxuICAgICAgICAvLyAgICAgLy8gUG9zaXRpb24gc3ByaXRlXG4gICAgICAgIC8vICAgICBPYmplY3QuYXNzaWduKHNwcml0ZS5wb3NpdGlvbiwgbWlkZGxlUG9zKTtcbiAgICAgICAgLy8gICB9fVxuICAgICAgLz5cbiAgICA8L21haW4+XG5cbiAgICAvLyA8L2Rpdj5cbiAgKTtcbn1cbiJdfQ==