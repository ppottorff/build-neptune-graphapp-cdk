"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_ec2_1 = require("@aws-sdk/client-ec2");
const client = new client_ec2_1.EC2Client({});
const INSTANCE_ID = process.env.INSTANCE_ID;
const handler = async (event) => {
    console.log(`Bastion scheduler: stopping instance ${INSTANCE_ID}`);
    try {
        await client.send(new client_ec2_1.StopInstancesCommand({ InstanceIds: [INSTANCE_ID] }));
        console.log(`Instance ${INSTANCE_ID} stop initiated`);
        return { statusCode: 200, body: `stop initiated for ${INSTANCE_ID}` };
    }
    catch (error) {
        // If already stopped, treat as success
        if (error.name === "IncorrectInstanceState") {
            console.log("Instance already stopped");
            return { statusCode: 200, body: "Instance already stopped" };
        }
        console.error("Failed to stop bastion:", error);
        throw error;
    }
};
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxvREFBc0U7QUFFdEUsTUFBTSxNQUFNLEdBQUcsSUFBSSxzQkFBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ2pDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBWSxDQUFDO0FBRXRDLE1BQU0sT0FBTyxHQUFHLEtBQUssRUFBRSxLQUF5QixFQUFFLEVBQUU7SUFDekQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUVuRSxJQUFJLENBQUM7UUFDSCxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQ2YsSUFBSSxpQ0FBb0IsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FDekQsQ0FBQztRQUNGLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxXQUFXLGlCQUFpQixDQUFDLENBQUM7UUFDdEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixXQUFXLEVBQUUsRUFBRSxDQUFDO0lBQ3hFLENBQUM7SUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1FBQ3BCLHVDQUF1QztRQUN2QyxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssd0JBQXdCLEVBQUUsQ0FBQztZQUM1QyxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFDeEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLDBCQUEwQixFQUFFLENBQUM7UUFDL0QsQ0FBQztRQUNELE9BQU8sQ0FBQyxLQUFLLENBQUMseUJBQXlCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDaEQsTUFBTSxLQUFLLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBbEJXLFFBQUEsT0FBTyxXQWtCbEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFQzJDbGllbnQsIFN0b3BJbnN0YW5jZXNDb21tYW5kIH0gZnJvbSBcIkBhd3Mtc2RrL2NsaWVudC1lYzJcIjtcblxuY29uc3QgY2xpZW50ID0gbmV3IEVDMkNsaWVudCh7fSk7XG5jb25zdCBJTlNUQU5DRV9JRCA9IHByb2Nlc3MuZW52LklOU1RBTkNFX0lEITtcblxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IHsgYWN0aW9uOiBcInN0b3BcIiB9KSA9PiB7XG4gIGNvbnNvbGUubG9nKGBCYXN0aW9uIHNjaGVkdWxlcjogc3RvcHBpbmcgaW5zdGFuY2UgJHtJTlNUQU5DRV9JRH1gKTtcblxuICB0cnkge1xuICAgIGF3YWl0IGNsaWVudC5zZW5kKFxuICAgICAgbmV3IFN0b3BJbnN0YW5jZXNDb21tYW5kKHsgSW5zdGFuY2VJZHM6IFtJTlNUQU5DRV9JRF0gfSlcbiAgICApO1xuICAgIGNvbnNvbGUubG9nKGBJbnN0YW5jZSAke0lOU1RBTkNFX0lEfSBzdG9wIGluaXRpYXRlZGApO1xuICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgYm9keTogYHN0b3AgaW5pdGlhdGVkIGZvciAke0lOU1RBTkNFX0lEfWAgfTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIC8vIElmIGFscmVhZHkgc3RvcHBlZCwgdHJlYXQgYXMgc3VjY2Vzc1xuICAgIGlmIChlcnJvci5uYW1lID09PSBcIkluY29ycmVjdEluc3RhbmNlU3RhdGVcIikge1xuICAgICAgY29uc29sZS5sb2coXCJJbnN0YW5jZSBhbHJlYWR5IHN0b3BwZWRcIik7XG4gICAgICByZXR1cm4geyBzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IFwiSW5zdGFuY2UgYWxyZWFkeSBzdG9wcGVkXCIgfTtcbiAgICB9XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzdG9wIGJhc3Rpb246XCIsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufTtcbiJdfQ==