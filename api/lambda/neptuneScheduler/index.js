"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_neptune_1 = require("@aws-sdk/client-neptune");
const client = new client_neptune_1.NeptuneClient({});
const CLUSTER_ID = process.env.NEPTUNE_CLUSTER_ID;
const handler = async (event) => {
    const { action } = event;
    console.log(`Neptune scheduler: ${action} cluster ${CLUSTER_ID}`);
    try {
        if (action === "stop") {
            await client.send(new client_neptune_1.StopDBClusterCommand({ DBClusterIdentifier: CLUSTER_ID }));
            console.log(`Cluster ${CLUSTER_ID} stop initiated`);
        }
        else if (action === "start") {
            await client.send(new client_neptune_1.StartDBClusterCommand({ DBClusterIdentifier: CLUSTER_ID }));
            console.log(`Cluster ${CLUSTER_ID} start initiated`);
        }
        else {
            throw new Error(`Unknown action: ${action}`);
        }
        return { statusCode: 200, body: `${action} initiated for ${CLUSTER_ID}` };
    }
    catch (error) {
        // If cluster is already in the desired state, treat as success
        if (error.name === "InvalidDBClusterStateFault" ||
            error.name === "InvalidClusterStateFault") {
            console.log(`Cluster already in desired state for action: ${action}`);
            return { statusCode: 200, body: `Cluster already ${action === "stop" ? "stopped" : "running"}` };
        }
        console.error(`Failed to ${action} cluster:`, error);
        throw error;
    }
};
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw0REFBcUc7QUFFckcsTUFBTSxNQUFNLEdBQUcsSUFBSSw4QkFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3JDLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQW1CLENBQUM7QUFFNUMsTUFBTSxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQW1DLEVBQUUsRUFBRTtJQUNuRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDO0lBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLE1BQU0sWUFBWSxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBRWxFLElBQUksQ0FBQztRQUNILElBQUksTUFBTSxLQUFLLE1BQU0sRUFBRSxDQUFDO1lBQ3RCLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLHFDQUFvQixDQUFDLEVBQUUsbUJBQW1CLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pGLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxVQUFVLGlCQUFpQixDQUFDLENBQUM7UUFDdEQsQ0FBQzthQUFNLElBQUksTUFBTSxLQUFLLE9BQU8sRUFBRSxDQUFDO1lBQzlCLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLHNDQUFxQixDQUFDLEVBQUUsbUJBQW1CLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2xGLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxVQUFVLGtCQUFrQixDQUFDLENBQUM7UUFDdkQsQ0FBQzthQUFNLENBQUM7WUFDTixNQUFNLElBQUksS0FBSyxDQUFDLG1CQUFtQixNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLENBQUM7UUFFRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGtCQUFrQixVQUFVLEVBQUUsRUFBRSxDQUFDO0lBQzVFLENBQUM7SUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1FBQ3BCLCtEQUErRDtRQUMvRCxJQUNFLEtBQUssQ0FBQyxJQUFJLEtBQUssNEJBQTRCO1lBQzNDLEtBQUssQ0FBQyxJQUFJLEtBQUssMEJBQTBCLEVBQ3pDLENBQUM7WUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLGdEQUFnRCxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQ3RFLE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxtQkFBbUIsTUFBTSxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDO1FBQ25HLENBQUM7UUFDRCxPQUFPLENBQUMsS0FBSyxDQUFDLGFBQWEsTUFBTSxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDckQsTUFBTSxLQUFLLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBNUJXLFFBQUEsT0FBTyxXQTRCbEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXB0dW5lQ2xpZW50LCBTdG9wREJDbHVzdGVyQ29tbWFuZCwgU3RhcnREQkNsdXN0ZXJDb21tYW5kIH0gZnJvbSBcIkBhd3Mtc2RrL2NsaWVudC1uZXB0dW5lXCI7XG5cbmNvbnN0IGNsaWVudCA9IG5ldyBOZXB0dW5lQ2xpZW50KHt9KTtcbmNvbnN0IENMVVNURVJfSUQgPSBwcm9jZXNzLmVudi5ORVBUVU5FX0NMVVNURVJfSUQhO1xuXG5leHBvcnQgY29uc3QgaGFuZGxlciA9IGFzeW5jIChldmVudDogeyBhY3Rpb246IFwic3RvcFwiIHwgXCJzdGFydFwiIH0pID0+IHtcbiAgY29uc3QgeyBhY3Rpb24gfSA9IGV2ZW50O1xuICBjb25zb2xlLmxvZyhgTmVwdHVuZSBzY2hlZHVsZXI6ICR7YWN0aW9ufSBjbHVzdGVyICR7Q0xVU1RFUl9JRH1gKTtcblxuICB0cnkge1xuICAgIGlmIChhY3Rpb24gPT09IFwic3RvcFwiKSB7XG4gICAgICBhd2FpdCBjbGllbnQuc2VuZChuZXcgU3RvcERCQ2x1c3RlckNvbW1hbmQoeyBEQkNsdXN0ZXJJZGVudGlmaWVyOiBDTFVTVEVSX0lEIH0pKTtcbiAgICAgIGNvbnNvbGUubG9nKGBDbHVzdGVyICR7Q0xVU1RFUl9JRH0gc3RvcCBpbml0aWF0ZWRgKTtcbiAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJzdGFydFwiKSB7XG4gICAgICBhd2FpdCBjbGllbnQuc2VuZChuZXcgU3RhcnREQkNsdXN0ZXJDb21tYW5kKHsgREJDbHVzdGVySWRlbnRpZmllcjogQ0xVU1RFUl9JRCB9KSk7XG4gICAgICBjb25zb2xlLmxvZyhgQ2x1c3RlciAke0NMVVNURVJfSUR9IHN0YXJ0IGluaXRpYXRlZGApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYWN0aW9uOiAke2FjdGlvbn1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IGAke2FjdGlvbn0gaW5pdGlhdGVkIGZvciAke0NMVVNURVJfSUR9YCB9O1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgLy8gSWYgY2x1c3RlciBpcyBhbHJlYWR5IGluIHRoZSBkZXNpcmVkIHN0YXRlLCB0cmVhdCBhcyBzdWNjZXNzXG4gICAgaWYgKFxuICAgICAgZXJyb3IubmFtZSA9PT0gXCJJbnZhbGlkREJDbHVzdGVyU3RhdGVGYXVsdFwiIHx8XG4gICAgICBlcnJvci5uYW1lID09PSBcIkludmFsaWRDbHVzdGVyU3RhdGVGYXVsdFwiXG4gICAgKSB7XG4gICAgICBjb25zb2xlLmxvZyhgQ2x1c3RlciBhbHJlYWR5IGluIGRlc2lyZWQgc3RhdGUgZm9yIGFjdGlvbjogJHthY3Rpb259YCk7XG4gICAgICByZXR1cm4geyBzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IGBDbHVzdGVyIGFscmVhZHkgJHthY3Rpb24gPT09IFwic3RvcFwiID8gXCJzdG9wcGVkXCIgOiBcInJ1bm5pbmdcIn1gIH07XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byAke2FjdGlvbn0gY2x1c3RlcjpgLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn07XG4iXX0=