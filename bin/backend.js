#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const neptune_network_stack_1 = require("../lib/neptune-network-stack");
const api_stack_1 = require("../lib/api-stack");
const waf_stack_1 = require("../lib/waf-stack");
const cdk_nag_1 = require("cdk-nag");
const config_1 = require("../config");
const NagLogger_1 = require("../nag/NagLogger");
const app = new cdk.App();
const logger = new NagLogger_1.NagLogger();
cdk.Aspects.of(app).add(new cdk_nag_1.AwsSolutionsChecks({ verbose: true, additionalLoggers: [logger] }));
const appName = config_1.deployConfig.appName || "graphApp";
const env = {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: config_1.deployConfig.region || process.env.CDK_DEFAULT_REGION,
};
const neptuneNetwork = new neptune_network_stack_1.NeptuneNetworkStack(app, `${appName}-NeptuneNetworkStack`, {
    natSubnet: false,
    maxAz: 2,
    neptuneServerlss: true,
    neptuneServerlssCapacity: {
        minCapacity: 1,
        maxCapacity: 2.5,
    },
    env,
});
new api_stack_1.ApiStack(app, `${appName}-ApiStack`, {
    cognito: {
        adminEmail: config_1.deployConfig.adminEmail,
    },
    vpc: neptuneNetwork.vpc,
    cluster: neptuneNetwork.cluster,
    clusterRole: neptuneNetwork.neptuneRole,
    graphqlFieldName: ["getGraph", "getProfile", "getRelationName", "insertData"],
    s3Uri: config_1.deployConfig.s3Uri,
    env,
});
new waf_stack_1.WafCloudFrontStack(app, `${appName}-WafStack`, {
    allowedIps: config_1.deployConfig.allowedIps,
    wafParamName: config_1.deployConfig.wafParamName,
    env: {
        ...env,
        region: "us-east-1",
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2VuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJhY2tlbmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsdUNBQXFDO0FBQ3JDLG1DQUFtQztBQUNuQyx3RUFBbUU7QUFDbkUsZ0RBQTRDO0FBQzVDLGdEQUFzRDtBQUN0RCxxQ0FBNkM7QUFFN0Msc0NBQXlDO0FBQ3pDLGdEQUE2QztBQUU3QyxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUMxQixNQUFNLE1BQU0sR0FBRyxJQUFJLHFCQUFTLEVBQUUsQ0FBQztBQUUvQixHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQ3JCLElBQUksNEJBQWtCLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUN2RSxDQUFDO0FBRUYsTUFBTSxPQUFPLEdBQUcscUJBQVksQ0FBQyxPQUFPLElBQUksVUFBVSxDQUFDO0FBQ25ELE1BQU0sR0FBRyxHQUFHO0lBQ1YsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CO0lBQ3hDLE1BQU0sRUFBRSxxQkFBWSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQjtDQUM5RCxDQUFDO0FBQ0YsTUFBTSxjQUFjLEdBQUcsSUFBSSwyQ0FBbUIsQ0FDNUMsR0FBRyxFQUNILEdBQUcsT0FBTyxzQkFBc0IsRUFDaEM7SUFDRSxTQUFTLEVBQUUsS0FBSztJQUNoQixLQUFLLEVBQUUsQ0FBQztJQUNSLGdCQUFnQixFQUFFLElBQUk7SUFDdEIsd0JBQXdCLEVBQUU7UUFDeEIsV0FBVyxFQUFFLENBQUM7UUFDZCxXQUFXLEVBQUUsR0FBRztLQUNqQjtJQUNELEdBQUc7Q0FDSixDQUNGLENBQUM7QUFFRixJQUFJLG9CQUFRLENBQUMsR0FBRyxFQUFFLEdBQUcsT0FBTyxXQUFXLEVBQUU7SUFDdkMsT0FBTyxFQUFFO1FBQ1AsVUFBVSxFQUFFLHFCQUFZLENBQUMsVUFBVTtLQUNwQztJQUNELEdBQUcsRUFBRSxjQUFjLENBQUMsR0FBRztJQUN2QixPQUFPLEVBQUUsY0FBYyxDQUFDLE9BQU87SUFDL0IsV0FBVyxFQUFFLGNBQWMsQ0FBQyxXQUFXO0lBQ3ZDLGdCQUFnQixFQUFFLENBQUMsVUFBVSxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxZQUFZLENBQUM7SUFDN0UsS0FBSyxFQUFFLHFCQUFZLENBQUMsS0FBSztJQUN6QixHQUFHO0NBQ0osQ0FBQyxDQUFDO0FBRUgsSUFBSSw4QkFBa0IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxPQUFPLFdBQVcsRUFBRTtJQUNqRCxVQUFVLEVBQUUscUJBQVksQ0FBQyxVQUFVO0lBQ25DLFlBQVksRUFBRSxxQkFBWSxDQUFDLFlBQVk7SUFDdkMsR0FBRyxFQUFFO1FBQ0gsR0FBRyxHQUFHO1FBQ04sTUFBTSxFQUFFLFdBQVc7S0FDcEI7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5pbXBvcnQgXCJzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXJcIjtcbmltcG9ydCAqIGFzIGNkayBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCB7IE5lcHR1bmVOZXR3b3JrU3RhY2sgfSBmcm9tIFwiLi4vbGliL25lcHR1bmUtbmV0d29yay1zdGFja1wiO1xuaW1wb3J0IHsgQXBpU3RhY2sgfSBmcm9tIFwiLi4vbGliL2FwaS1zdGFja1wiO1xuaW1wb3J0IHsgV2FmQ2xvdWRGcm9udFN0YWNrIH0gZnJvbSBcIi4uL2xpYi93YWYtc3RhY2tcIjtcbmltcG9ydCB7IEF3c1NvbHV0aW9uc0NoZWNrcyB9IGZyb20gXCJjZGstbmFnXCI7XG5cbmltcG9ydCB7IGRlcGxveUNvbmZpZyB9IGZyb20gXCIuLi9jb25maWdcIjtcbmltcG9ydCB7IE5hZ0xvZ2dlciB9IGZyb20gXCIuLi9uYWcvTmFnTG9nZ2VyXCI7XG5cbmNvbnN0IGFwcCA9IG5ldyBjZGsuQXBwKCk7XG5jb25zdCBsb2dnZXIgPSBuZXcgTmFnTG9nZ2VyKCk7XG5cbmNkay5Bc3BlY3RzLm9mKGFwcCkuYWRkKFxuICBuZXcgQXdzU29sdXRpb25zQ2hlY2tzKHsgdmVyYm9zZTogdHJ1ZSwgYWRkaXRpb25hbExvZ2dlcnM6IFtsb2dnZXJdIH0pXG4pO1xuXG5jb25zdCBhcHBOYW1lID0gZGVwbG95Q29uZmlnLmFwcE5hbWUgfHwgXCJncmFwaEFwcFwiO1xuY29uc3QgZW52ID0ge1xuICBhY2NvdW50OiBwcm9jZXNzLmVudi5DREtfREVGQVVMVF9BQ0NPVU5ULFxuICByZWdpb246IGRlcGxveUNvbmZpZy5yZWdpb24gfHwgcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfUkVHSU9OLFxufTtcbmNvbnN0IG5lcHR1bmVOZXR3b3JrID0gbmV3IE5lcHR1bmVOZXR3b3JrU3RhY2soXG4gIGFwcCxcbiAgYCR7YXBwTmFtZX0tTmVwdHVuZU5ldHdvcmtTdGFja2AsXG4gIHtcbiAgICBuYXRTdWJuZXQ6IGZhbHNlLFxuICAgIG1heEF6OiAyLFxuICAgIG5lcHR1bmVTZXJ2ZXJsc3M6IHRydWUsXG4gICAgbmVwdHVuZVNlcnZlcmxzc0NhcGFjaXR5OiB7XG4gICAgICBtaW5DYXBhY2l0eTogMSxcbiAgICAgIG1heENhcGFjaXR5OiAyLjUsXG4gICAgfSxcbiAgICBlbnYsXG4gIH1cbik7XG5cbm5ldyBBcGlTdGFjayhhcHAsIGAke2FwcE5hbWV9LUFwaVN0YWNrYCwge1xuICBjb2duaXRvOiB7XG4gICAgYWRtaW5FbWFpbDogZGVwbG95Q29uZmlnLmFkbWluRW1haWwsXG4gIH0sXG4gIHZwYzogbmVwdHVuZU5ldHdvcmsudnBjLFxuICBjbHVzdGVyOiBuZXB0dW5lTmV0d29yay5jbHVzdGVyLFxuICBjbHVzdGVyUm9sZTogbmVwdHVuZU5ldHdvcmsubmVwdHVuZVJvbGUsXG4gIGdyYXBocWxGaWVsZE5hbWU6IFtcImdldEdyYXBoXCIsIFwiZ2V0UHJvZmlsZVwiLCBcImdldFJlbGF0aW9uTmFtZVwiLCBcImluc2VydERhdGFcIl0sXG4gIHMzVXJpOiBkZXBsb3lDb25maWcuczNVcmksXG4gIGVudixcbn0pO1xuXG5uZXcgV2FmQ2xvdWRGcm9udFN0YWNrKGFwcCwgYCR7YXBwTmFtZX0tV2FmU3RhY2tgLCB7XG4gIGFsbG93ZWRJcHM6IGRlcGxveUNvbmZpZy5hbGxvd2VkSXBzLFxuICB3YWZQYXJhbU5hbWU6IGRlcGxveUNvbmZpZy53YWZQYXJhbU5hbWUsXG4gIGVudjoge1xuICAgIC4uLmVudixcbiAgICByZWdpb246IFwidXMtZWFzdC0xXCIsXG4gIH0sXG59KTtcbiJdfQ==