#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const neptune_network_stack_1 = require("../lib/neptune-network-stack");
const api_stack_1 = require("../lib/api-stack");
const waf_stack_1 = require("../lib/waf-stack");
const observability_stack_1 = require("../lib/observability-stack");
const cdk_nag_1 = require("cdk-nag");
const config_1 = require("../config");
const NagLogger_1 = require("../nag/NagLogger");
const app = new cdk.App();
const logger = new NagLogger_1.NagLogger();
cdk.Aspects.of(app).add(new cdk_nag_1.AwsSolutionsChecks({ verbose: true, additionalLoggers: [logger] }));
const appName = config_1.deployConfig.appName || "graphApp";
const env = {
    account: process.env.CDK_DEFAULT_ACCOUNT || process.env.AWS_ACCOUNT_ID,
    region: config_1.deployConfig.region || process.env.CDK_DEFAULT_REGION,
};
const neptuneNetwork = new neptune_network_stack_1.NeptuneNetworkStack(app, `${appName}-NeptuneNetworkStack`, {
    natSubnet: false,
    maxAz: 2,
    neptuneServerlss: true,
    neptuneServerlssCapacity: {
        minCapacity: 1,
        maxCapacity: 2.5,
    },
    // Stop Neptune 12am–4pm Pacific to save costs
    neptuneSchedule: {
        enabled: true,
        timezone: "America/Los_Angeles",
        stopHour: 0, // midnight Pacific — cluster stops
        startHour: 16, // 4pm Pacific — cluster starts
    },
    // Bastion host for remote Neptune access via SSM
    bastion: {
        enabled: true,
        timezone: "America/Los_Angeles",
        stopHour: 0, // midnight Pacific — bastion stops
    },
    env,
});
const apiStack = new api_stack_1.ApiStack(app, `${appName}-ApiStack`, {
    cognito: {
        adminEmail: config_1.deployConfig.adminEmail,
    },
    vpc: neptuneNetwork.vpc,
    cluster: neptuneNetwork.cluster,
    clusterRole: neptuneNetwork.neptuneRole,
    graphqlFieldName: ["getGraph", "getProfile", "getRelationName", "insertData", "askGraph"],
    s3Uri: config_1.deployConfig.s3Uri,
    env,
});
new waf_stack_1.WafCloudFrontStack(app, `${appName}-WafStack`, {
    allowedIps: config_1.deployConfig.allowedIps,
    wafParamName: config_1.deployConfig.wafParamName,
    env: {
        ...env,
        region: "us-east-1",
    },
});
// ── Observability: Dashboard, Alarms, and Cognito read-only policies ──
const observability = new observability_stack_1.ObservabilityStack(app, `${appName}-ObservabilityStack`, {
    neptuneClusterId: neptuneNetwork.cluster.clusterIdentifier,
    cloudFrontDistributionId: "PLACEHOLDER", // Resolved at deploy via SSM or manual update
    wafWebAclName: config_1.deployConfig.wafParamName,
    appSyncApiId: apiStack.graphqlApiId,
    lambdaFunctions: apiStack.lambdaFunctionNames,
    userPoolId: apiStack.cognito.cognitoParams.userPoolId,
    env,
});
// Grant the Cognito authenticated role read-only access for the monitoring UI
const authRole = apiStack.cognito.authenticatedRole;
authRole.addToPrincipalPolicy(new cdk.aws_iam.PolicyStatement({
    sid: "MonitoringCloudWatchReadOnly",
    effect: cdk.aws_iam.Effect.ALLOW,
    actions: [
        "cloudwatch:GetMetricData",
        "cloudwatch:GetMetricWidgetImage",
        "cloudwatch:DescribeAlarms",
        "cloudwatch:GetDashboard",
        "cloudwatch:ListDashboards",
        "cloudwatch:ListMetrics",
    ],
    resources: ["*"],
}));
authRole.addToPrincipalPolicy(new cdk.aws_iam.PolicyStatement({
    sid: "MonitoringEC2ReadOnly",
    effect: cdk.aws_iam.Effect.ALLOW,
    actions: [
        "ec2:DescribeInstances",
        "ec2:DescribeInstanceStatus",
    ],
    resources: ["*"],
}));
authRole.addToPrincipalPolicy(new cdk.aws_iam.PolicyStatement({
    sid: "MonitoringNeptuneReadOnly",
    effect: cdk.aws_iam.Effect.ALLOW,
    actions: [
        "rds:DescribeDBClusters",
        "rds:DescribeDBInstances",
    ],
    resources: ["*"],
}));
authRole.addToPrincipalPolicy(new cdk.aws_iam.PolicyStatement({
    sid: "MonitoringAppSyncReadOnly",
    effect: cdk.aws_iam.Effect.ALLOW,
    actions: ["appsync:GetGraphqlApi"],
    resources: ["*"],
}));
authRole.addToPrincipalPolicy(new cdk.aws_iam.PolicyStatement({
    sid: "MonitoringLambdaReadOnly",
    effect: cdk.aws_iam.Effect.ALLOW,
    actions: ["lambda:GetFunction", "lambda:ListFunctions"],
    resources: ["*"],
}));
authRole.addToPrincipalPolicy(new cdk.aws_iam.PolicyStatement({
    sid: "MonitoringXRayReadOnly",
    effect: cdk.aws_iam.Effect.ALLOW,
    actions: [
        "xray:GetTraceSummaries",
        "xray:BatchGetTraces",
        "xray:GetServiceGraph",
    ],
    resources: ["*"],
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2VuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJhY2tlbmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsdUNBQXFDO0FBQ3JDLG1DQUFtQztBQUNuQyx3RUFBbUU7QUFDbkUsZ0RBQTRDO0FBQzVDLGdEQUFzRDtBQUN0RCxvRUFBZ0U7QUFDaEUscUNBQTZDO0FBRTdDLHNDQUF5QztBQUN6QyxnREFBNkM7QUFFN0MsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDMUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxxQkFBUyxFQUFFLENBQUM7QUFFL0IsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUNyQixJQUFJLDRCQUFrQixDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FDdkUsQ0FBQztBQUVGLE1BQU0sT0FBTyxHQUFHLHFCQUFZLENBQUMsT0FBTyxJQUFJLFVBQVUsQ0FBQztBQUNuRCxNQUFNLEdBQUcsR0FBRztJQUNWLE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYztJQUN0RSxNQUFNLEVBQUUscUJBQVksQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0I7Q0FDOUQsQ0FBQztBQUNGLE1BQU0sY0FBYyxHQUFHLElBQUksMkNBQW1CLENBQzVDLEdBQUcsRUFDSCxHQUFHLE9BQU8sc0JBQXNCLEVBQ2hDO0lBQ0UsU0FBUyxFQUFFLEtBQUs7SUFDaEIsS0FBSyxFQUFFLENBQUM7SUFDUixnQkFBZ0IsRUFBRSxJQUFJO0lBQ3RCLHdCQUF3QixFQUFFO1FBQ3hCLFdBQVcsRUFBRSxDQUFDO1FBQ2QsV0FBVyxFQUFFLEdBQUc7S0FDakI7SUFDRCw4Q0FBOEM7SUFDOUMsZUFB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b3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXJcIjtcbmltcG9ydCAqIGFzIGNkayBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCB7IE5lcHR1bmVOZXR3b3JrU3RhY2sgfSBmcm9tIFwiLi4vbGliL25lcHR1bmUtbmV0d29yay1zdGFja1wiO1xuaW1wb3J0IHsgQXBpU3RhY2sgfSBmcm9tIFwiLi4vbGliL2FwaS1zdGFja1wiO1xuaW1wb3J0IHsgV2FmQ2xvdWRGcm9udFN0YWNrIH0gZnJvbSBcIi4uL2xpYi93YWYtc3RhY2tcIjtcbmltcG9ydCB7IE9ic2VydmFiaWxpdHlTdGFjayB9IGZyb20gXCIuLi9saWIvb2JzZXJ2YWJpbGl0eS1zdGFja1wiO1xuaW1wb3J0IHsgQXdzU29sdXRpb25zQ2hlY2tzIH0gZnJvbSBcImNkay1uYWdcIjtcblxuaW1wb3J0IHsgZGVwbG95Q29uZmlnIH0gZnJvbSBcIi4uL2NvbmZpZ1wiO1xuaW1wb3J0IHsgTmFnTG9nZ2VyIH0gZnJvbSBcIi4uL25hZy9OYWdMb2dnZXJcIjtcblxuY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcbmNvbnN0IGxvZ2dlciA9IG5ldyBOYWdMb2dnZXIoKTtcblxuY2RrLkFzcGVjdHMub2YoYXBwKS5hZGQoXG4gIG5ldyBBd3NTb2x1dGlvbnNDaGVja3MoeyB2ZXJib3NlOiB0cnVlLCBhZGRpdGlvbmFsTG9nZ2VyczogW2xvZ2dlcl0gfSlcbik7XG5cbmNvbnN0IGFwcE5hbWUgPSBkZXBsb3lDb25maWcuYXBwTmFtZSB8fCBcImdyYXBoQXBwXCI7XG5jb25zdCBlbnYgPSB7XG4gIGFjY291bnQ6IHByb2Nlc3MuZW52LkNES19ERUZBVUxUX0FDQ09VTlQgfHwgcHJvY2Vzcy5lbnYuQVdTX0FDQ09VTlRfSUQsXG4gIHJlZ2lvbjogZGVwbG95Q29uZmlnLnJlZ2lvbiB8fCBwcm9jZXNzLmVudi5DREtfREVGQVVMVF9SRUdJT04sXG59O1xuY29uc3QgbmVwdHVuZU5ldHdvcmsgPSBuZXcgTmVwdHVuZU5ldHdvcmtTdGFjayhcbiAgYXBwLFxuICBgJHthcHBOYW1lfS1OZXB0dW5lTmV0d29ya1N0YWNrYCxcbiAge1xuICAgIG5hdFN1Ym5ldDogZmFsc2UsXG4gICAgbWF4QXo6IDIsXG4gICAgbmVwdHVuZVNlcnZlcmxzczogdHJ1ZSxcbiAgICBuZXB0dW5lU2VydmVybHNzQ2FwYWNpdHk6IHtcbiAgICAgIG1pbkNhcGFjaXR5OiAxLFxuICAgICAgbWF4Q2FwYWNpdHk6IDIuNSxcbiAgICB9LFxuICAgIC8vIFN0b3AgTmVwdHVuZSAxMmFt4oCTNHBtIFBhY2lmaWMgdG8gc2F2ZSBjb3N0c1xuICAgIG5lcHR1bmVTY2hlZHVsZToge1xuICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgIHRpbWV6b25lOiBcIkFtZXJpY2EvTG9zX0FuZ2VsZXNcIixcbiAgICAgIHN0b3BIb3VyOiAwLCAgIC8vIG1pZG5pZ2h0IFBhY2lmaWMg4oCUIGNsdXN0ZXIgc3RvcHNcbiAgICAgIHN0YXJ0SG91cjogMTYsICAvLyA0cG0gUGFjaWZpYyDigJQgY2x1c3RlciBzdGFydHNcbiAgICB9LFxuICAgIC8vIEJhc3Rpb24gaG9zdCBmb3IgcmVtb3RlIE5lcHR1bmUgYWNjZXNzIHZpYSBTU01cbiAgICBiYXN0aW9uOiB7XG4gICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgdGltZXpvbmU6IFwiQW1lcmljYS9Mb3NfQW5nZWxlc1wiLFxuICAgICAgc3RvcEhvdXI6IDAsICAvLyBtaWRuaWdodCBQYWNpZmljIOKAlCBiYXN0aW9uIHN0b3BzXG4gICAgfSxcbiAgICBlbnYsXG4gIH1cbik7XG5cbmNvbnN0IGFwaVN0YWNrID0gbmV3IEFwaVN0YWNrKGFwcCwgYCR7YXBwTmFtZX0tQXBpU3RhY2tgLCB7XG4gIGNvZ25pdG86IHtcbiAgICBhZG1pbkVtYWlsOiBkZXBsb3lDb25maWcuYWRtaW5FbWFpbCxcbiAgfSxcbiAgdnBjOiBuZXB0dW5lTmV0d29yay52cGMsXG4gIGNsdXN0ZXI6IG5lcHR1bmVOZXR3b3JrLmNsdXN0ZXIsXG4gIGNsdXN0ZXJSb2xlOiBuZXB0dW5lTmV0d29yay5uZXB0dW5lUm9sZSxcbiAgZ3JhcGhxbEZpZWxkTmFtZTogW1wiZ2V0R3JhcGhcIiwgXCJnZXRQcm9maWxlXCIsIFwiZ2V0UmVsYXRpb25OYW1lXCIsIFwiaW5zZXJ0RGF0YVwiLCBcImFza0dyYXBoXCJdLFxuICBzM1VyaTogZGVwbG95Q29uZmlnLnMzVXJpLFxuICBlbnYsXG59KTtcblxubmV3IFdhZkNsb3VkRnJvbnRTdGFjayhhcHAsIGAke2FwcE5hbWV9LVdhZlN0YWNrYCwge1xuICBhbGxvd2VkSXBzOiBkZXBsb3lDb25maWcuYWxsb3dlZElwcyxcbiAgd2FmUGFyYW1OYW1lOiBkZXBsb3lDb25maWcud2FmUGFyYW1OYW1lLFxuICBlbnY6IHtcbiAgICAuLi5lbnYsXG4gICAgcmVnaW9uOiBcInVzLWVhc3QtMVwiLFxuICB9LFxufSk7XG5cbi8vIOKUgOKUgCBPYnNlcnZhYmlsaXR5OiBEYXNoYm9hcmQsIEFsYXJtcywgYW5kIENvZ25pdG8gcmVhZC1vbmx5IHBvbGljaWVzIOKUgOKUgFxuY29uc3Qgb2JzZXJ2YWJpbGl0eSA9IG5ldyBPYnNlcnZhYmlsaXR5U3RhY2soYXBwLCBgJHthcHBOYW1lfS1PYnNlcnZhYmlsaXR5U3RhY2tgLCB7XG4gIG5lcHR1bmVDbHVzdGVySWQ6IG5lcHR1bmVOZXR3b3JrLmNsdXN0ZXIuY2x1c3RlcklkZW50aWZpZXIsXG4gIGNsb3VkRnJvbnREaXN0cmlidXRpb25JZDogXCJQTEFDRUhPTERFUlwiLCAvLyBSZXNvbHZlZCBhdCBkZXBsb3kgdmlhIFNTTSBvciBtYW51YWwgdXBkYXRlXG4gIHdhZldlYkFjbE5hbWU6IGRlcGxveUNvbmZpZy53YWZQYXJhbU5hbWUsXG4gIGFwcFN5bmNBcGlJZDogYXBpU3RhY2suZ3JhcGhxbEFwaUlkLFxuICBsYW1iZGFGdW5jdGlvbnM6IGFwaVN0YWNrLmxhbWJkYUZ1bmN0aW9uTmFtZXMsXG4gIHVzZXJQb29sSWQ6IGFwaVN0YWNrLmNvZ25pdG8uY29nbml0b1BhcmFtcy51c2VyUG9vbElkLFxuICBlbnYsXG59KTtcblxuLy8gR3JhbnQgdGhlIENvZ25pdG8gYXV0aGVudGljYXRlZCByb2xlIHJlYWQtb25seSBhY2Nlc3MgZm9yIHRoZSBtb25pdG9yaW5nIFVJXG5jb25zdCBhdXRoUm9sZSA9IGFwaVN0YWNrLmNvZ25pdG8uYXV0aGVudGljYXRlZFJvbGU7XG5hdXRoUm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgbmV3IGNkay5hd3NfaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgc2lkOiBcIk1vbml0b3JpbmdDbG91ZFdhdGNoUmVhZE9ubHlcIixcbiAgICBlZmZlY3Q6IGNkay5hd3NfaWFtLkVmZmVjdC5BTExPVyxcbiAgICBhY3Rpb25zOiBbXG4gICAgICBcImNsb3Vkd2F0Y2g6R2V0TWV0cmljRGF0YVwiLFxuICAgICAgXCJjbG91ZHdhdGNoOkdldE1ldHJpY1dpZGdldEltYWdlXCIsXG4gICAgICBcImNsb3Vkd2F0Y2g6RGVzY3JpYmVBbGFybXNcIixcbiAgICAgIFwiY2xvdWR3YXRjaDpHZXREYXNoYm9hcmRcIixcbiAgICAgIFwiY2xvdWR3YXRjaDpMaXN0RGFzaGJvYXJkc1wiLFxuICAgICAgXCJjbG91ZHdhdGNoOkxpc3RNZXRyaWNzXCIsXG4gICAgXSxcbiAgICByZXNvdXJjZXM6IFtcIipcIl0sXG4gIH0pXG4pO1xuYXV0aFJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3koXG4gIG5ldyBjZGsuYXdzX2lhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgIHNpZDogXCJNb25pdG9yaW5nRUMyUmVhZE9ubHlcIixcbiAgICBlZmZlY3Q6IGNkay5hd3NfaWFtLkVmZmVjdC5BTExPVyxcbiAgICBhY3Rpb25zOiBbXG4gICAgICBcImVjMjpEZXNjcmliZUluc3RhbmNlc1wiLFxuICAgICAgXCJlYzI6RGVzY3JpYmVJbnN0YW5jZVN0YXR1c1wiLFxuICAgIF0sXG4gICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxuICB9KVxuKTtcbmF1dGhSb2xlLmFkZFRvUHJpbmNpcGFsUG9saWN5KFxuICBuZXcgY2RrLmF3c19pYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICBzaWQ6IFwiTW9uaXRvcmluZ05lcHR1bmVSZWFkT25seVwiLFxuICAgIGVmZmVjdDogY2RrLmF3c19pYW0uRWZmZWN0LkFMTE9XLFxuICAgIGFjdGlvbnM6IFtcbiAgICAgIFwicmRzOkRlc2NyaWJlREJDbHVzdGVyc1wiLFxuICAgICAgXCJyZHM6RGVzY3JpYmVEQkluc3RhbmNlc1wiLFxuICAgIF0sXG4gICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxuICB9KVxuKTtcbmF1dGhSb2xlLmFkZFRvUHJpbmNpcGFsUG9saWN5KFxuICBuZXcgY2RrLmF3c19pYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICBzaWQ6IFwiTW9uaXRvcmluZ0FwcFN5bmNSZWFkT25seVwiLFxuICAgIGVmZmVjdDogY2RrLmF3c19pYW0uRWZmZWN0LkFMTE9XLFxuICAgIGFjdGlvbnM6IFtcImFwcHN5bmM6R2V0R3JhcGhxbEFwaVwiXSxcbiAgICByZXNvdXJjZXM6IFtcIipcIl0sXG4gIH0pXG4pO1xuYXV0aFJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3koXG4gIG5ldyBjZGsuYXdzX2lhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgIHNpZDogXCJNb25pdG9yaW5nTGFtYmRhUmVhZE9ubHlcIixcbiAgICBlZmZlY3Q6IGNkay5hd3NfaWFtLkVmZmVjdC5BTExPVyxcbiAgICBhY3Rpb25zOiBbXCJsYW1iZGE6R2V0RnVuY3Rpb25cIiwgXCJsYW1iZGE6TGlzdEZ1bmN0aW9uc1wiXSxcbiAgICByZXNvdXJjZXM6IFtcIipcIl0sXG4gIH0pXG4pO1xuYXV0aFJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3koXG4gIG5ldyBjZGsuYXdzX2lhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgIHNpZDogXCJNb25pdG9yaW5nWFJheVJlYWRPbmx5XCIsXG4gICAgZWZmZWN0OiBjZGsuYXdzX2lhbS5FZmZlY3QuQUxMT1csXG4gICAgYWN0aW9uczogW1xuICAgICAgXCJ4cmF5OkdldFRyYWNlU3VtbWFyaWVzXCIsXG4gICAgICBcInhyYXk6QmF0Y2hHZXRUcmFjZXNcIixcbiAgICAgIFwieHJheTpHZXRTZXJ2aWNlR3JhcGhcIixcbiAgICBdLFxuICAgIHJlc291cmNlczogW1wiKlwiXSxcbiAgfSlcbik7XG4iXX0=